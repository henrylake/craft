!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var s=e();for(var r in s)("object"==typeof exports?exports:t)[r]=s[r]}}(window,function(){return function(t){var e={};function s(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,s),i.l=!0,i.exports}return s.m=t,s.c=e,s.d=function(t,e,r){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)s.d(r,i,function(e){return t[e]}.bind(null,i));return r},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=6)}([function(t,e){var s;s=function(){return this}();try{s=s||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(s=window)}t.exports=s},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},function(t,e){t.exports.get=function(t){let e=(e,s)=>{let r=["streetlamps","solarpanels","porchlights","windmills"];if(r.includes(e))return!0;let i=[];i.push(e.toLowerCase());let n=e.replace(/\s/g,"");i.push(n);let o=e+"s";i.push(o);let a=n.toLowerCase();i.push(a);let l=o.toLowerCase();i.push(l);let h=o.replace(/\s/g,"");i.push(h);let c=h.toLowerCase();i.push(c);for(let n=0;n<i.length;n++)if(r.includes(i[n]))return t.errorThrown||(console.error(`You passed '${e}' to the '${s}' function - did you mean '${i[n]}'?`),t.endWithError()),t.errorThrown=!0,!1};return{log_scene(){console.log("Scene within API",t)},turn_on_by_id(s,r){if(e(s,"turn_on_by_id"))switch(s){case"streetlamps":t.streetlamps?t.streetlamps.streetlamps[r].turnOn():console.log("ALERT: No Streetlamps");break;case"solarpanels":t.houses?t.houses.houses[r].solar_panel.turnOn():console.log("ALERT: No Solarpanels");break;case"porchlights":t.houses?t.houses.houses[r].porch_light.turnOn():console.log("ALERT: No Porchlights")}},turn_off_by_id(s,r){if(e(s,"turn_off_by_id"))switch(s){case"streetlamps":t.streetlamps?t.streetlamps.streetlamps[r].turnOff():console.log("ALERT: No Streetlamps");break;case"solarpanels":t.houses?t.houses.houses[r].solar_panel.turnOff():console.log("ALERT: No Solarpanels");break;case"porchlights":t.houses?t.houses.houses[r].porch_light.turnOff():console.log("ALERT: No Porchlights")}},low_power_by_id(s,r){if(e(s,"low_power_by_id"))switch(s){case"streetlamps":t.streetlamps?t.streetlamps.streetlamps[r].lowPower():console.log("ALERT: No Streetlamps")}},turn_on(s){if(e(s,"turn_on"))switch(s){case"streetlamps":t.streetlamps?(t.setState("streetlamps",!0),t.low_power=!1,t.streetlamps.all("turnOn")):console.log("ALERT: No Streetlamps");break;case"solarpanels":t.houses.houses[0].solar_panel?(t.setState("solar_panels",!0),t.houses.all("solar_panel","turnOn")):console.log("ALERT: No Solarpanels");break;case"porchlights":t.houses.houses[0].porch_light?(t.setState("porch_lights",!0),t.houses.all("porch_light","turnOn")):console.log("ALERT: No Porchlights")}},turn_off(s){if(e(s,"turn_off"))switch(s){case"streetlamps":t.streetlamps?(t.setState("streetlamps",!1),t.low_power=!1,t.streetlamps.all("turnOff")):console.log("ALERT: No Streetlamps");break;case"solarpanels":t.houses.houses[0].solar_panel?(t.setState("solar_panels",!1),t.houses.all("solar_panel","turnOff")):console.log("ALERT: No Solarpanels");break;case"porchlights":t.houses.houses[0].porch_light?(t.setState("porch_lights",!1),t.houses.all("porch_light","turnOff")):console.log("ALERT: No Porchlights")}},low_power(s){if(e(s,"low_power"))switch(s){case"streetlamps":t.streetlamps?(t.setState("streetlamps",!0),t.low_power=!0,t.streetlamps.all("lowPower")):console.log("ALERT: No Streetlamps")}},set_pitch(e){e>=0&&e<=90?t.blade_pitch=e:console.log("ALERT: PITCH OUT OF BOUNDS")},generate_energy(e){let s=0;switch(e){case"windmills":t.windmills.windmills.forEach(e=>{s+=e.createEnergy(t.wind)})}return s},is_battery_empty:()=>t.battery.isEmpty,is_battery_full:()=>t.battery.isFull,charge_battery(e){t.battery.charge(e),t.batteryLabel.setValue(t.battery.energyValue)},use_battery(e){t.battery.use(e),t.batteryLabel.setValue(t.battery.energyValue)},get_energy:()=>t.battery.energy,get_wind:()=>t.wind,get_light:()=>t.light,get_time:()=>t.worldTime,get_dark:()=>t.worldTime<=t.dawn||t.worldTime>=t.dusk,get_houses:()=>t.noHouses,get_streetlamps:()=>t.noHouses,get_proximity_by_id(s,r){if(e(s,"get_proximity_by_id"))switch(s){case"streetlamps":if(t.streetlamps.streetlamps[r])return t.streetlamps.streetlamps[r].getNearestDistance(t.players,!0);console.error("ALERT: No Streetlamps with id:",r);break;case"porchlights":if(t.houses)return t.houses.houses[r].porch_light.getNearestDistance(t.players,!0);console.error("ALERT: No Porchlight with this id:",r)}}}}},function(t,e,s){var r=s(4),i=s(5);t.exports.get=function(t){let e=t=>{let e=t;switch(t){case"solarpanels":e="solar_panels";break;case"porchlights":e="porch_lights"}return e},s=(t,e=!0)=>{let s=t;if(Array.isArray(t)){let e=(s=t.map(t=>"number"==typeof t?t:t?"on":"off"))[0];s.every(t=>t==e)&&(s=e)}else switch(t){case"worldTime":s="time";break;case"porch_lights":s=e?"porchlights":"porchlight";break;case"solar_panels":s=e?"solarpanels":"solarpanel";break;case"streetlamps":s=e?"streetlamps":"streetlamp";break;case"blade_pitch":s="blade pitch";break;case"low_power":s="low power mode";break;case"low_power_by_id":s="low power";break;case"proximities":s="proximities";break;case"byId":s="";break;case!0:s="on";break;case!1:s="off"}return s};return{getRecordState:()=>t.recordState,getErrorKeys(){let e=[];for(const[s,r]of Object.entries(t.errorStates))r&&e.push(s);return e},recordCheck:e=>!!t.recordState.every(t=>{if(e(t))return!0}),comparisonCheck(e){let n=[],o=[],a=t.recordState.every(a=>{let l=i(a),h=["time","light","wind","proximities"];if(e(l),r(l,a))return!0;for(const[e,i]of Object.entries(l))if("byId"==e||"proximities"==e||"low_power_by_id"==e)for(const[i,c]of Object.entries(l[e]))t.errorStates[e][i]&&(r(l[e][i],a[e][i])?h.includes(e)&&n.push(`${s(i,!1)} ${s(e)} = ${s(c)}`):o.push(`the ${s(i,!1)} ${s(e)} values should have been ${s(c)} however in your simulation they were ${s(a[e][i])}`));else if(t.errorStates[e]){let t=["streetlamps","porch_lights","solar_panels"];r(l[e],a[e])?h.includes(e)&&n.push(`${s(e)} = ${s(i)}`):t.includes(e)?o.push(`the ${s(e)} should have been ${s(i)} however in your simulation they were ${s(a[e])}`):o.push(`the ${s(e)} should have been ${s(i)} however in your simulation it was ${s(a[e])}`)}t.errorStates.dark&&n.push(`get_dark = ${this.get_dark(l)}`)}),l="";return l=n!=[]?`Your solution failed when ${n.join(", ")} because ${o.join(" and ")}.`:`Your solution failed because ${o.join(" and ")}.`,a?{pass:!0}:{pass:!1,errorMessage:l}},turn_on(s,r){s[e(r)]=!0,t.errorStates[e(r)]=!0,(r="streetlamps")&&(s.low_power=!1)},turn_on_by_id(s,r,i){s.byId[e(r)][i]=!0,t.errorStates.byId[e(r)]=!0},turn_off_by_id(s,r,i){s.byId[e(r)][i]=!1,t.errorStates.byId[e(r)]=!0},low_power_by_id(s,r,i){s.low_power_by_id[e(r)][i]=!0,t.errorStates.low_power_by_id[e(r)]=!0},get_proximity_by_id:(s,r,i)=>(t.errorStates.proximities[e(r)]=!0,Math.round(s.proximities[e(r)][i])),low_power(s,r){t.errorStates.low_power=!0,s[e(r)]=!0,s.low_power=!0},turn_off(s,r){s[e(r)]=!1,t.errorStates[e(r)]=!0,(r="streetlamps")&&(s.low_power=!1)},set_pitch(e,s){t.errorStates.blade_pitch=!0,s>=0&&s<=90?e.blade_pitch=s:console.log("ALERT: PITCH OUT OF BOUNDS")},is_on:(t,s)=>1==t[e(s)],is_off:(t,s)=>1!=t[e(s)],get_dark:e=>(t.errorStates.dark=!0,e.worldTime<=t.dawn||e.worldTime>=t.dusk),get_light:e=>(t.errorStates.light=!0,e.light),get_wind:e=>(t.errorStates.wind=!0,e.wind),get_time:e=>(t.errorStates.worldTime=!0,e.worldTime),get_houses:()=>t.noHouses,get_streetlamps:()=>t.noHouses,streetlamps:e=>"on"==e?t.onStates.streetlamps:!t.onStates.streetlamps,stateWhile(s,r,i,n,o,a=!1){"on"==r?r=!0:"off"==r&&(r=!1);for(let l=0;l<t.recordState.length;l++){let h=t.recordState[l],c=h[i],u=h[e(s)],p=!1;switch(n){case"less":p=c<o;break;case"less equal":p=c<=o;break;case"greater":p=c>o;break;case"greater equal":p=c>=o;break;case"between equal":p=c<=o&&c>=a;break;case"between":p=c<o&&c>a}if(p&&u!=r)return!1}return!0},getRecordsAtWorldState(s,r){let i=[];for(let n=0;n<t.recordState.length;n++){let o=t.recordState[n];o[e(s)]==r&&i.push(o)}return i},mirrorSimulate(s,r){let i=[];for(let n=0;n<t.recordState.length;n++){let o=t.recordState[n];o[e(s)]==r&&i.push(o)}return i}}}},function(t,e,s){(function(t,s){var r=200,i="__lodash_hash_undefined__",n=1,o=2,a=9007199254740991,l="[object Arguments]",h="[object Array]",c="[object AsyncFunction]",u="[object Boolean]",p="[object Date]",d="[object Error]",_="[object Function]",f="[object GeneratorFunction]",g="[object Map]",y="[object Number]",m="[object Null]",w="[object Object]",b="[object Proxy]",S="[object RegExp]",v="[object Set]",k="[object String]",x="[object Symbol]",j="[object Undefined]",$="[object ArrayBuffer]",C="[object DataView]",T=/^\[object .+?Constructor\]$/,O=/^(?:0|[1-9]\d*)$/,A={};A["[object Float32Array]"]=A["[object Float64Array]"]=A["[object Int8Array]"]=A["[object Int16Array]"]=A["[object Int32Array]"]=A["[object Uint8Array]"]=A["[object Uint8ClampedArray]"]=A["[object Uint16Array]"]=A["[object Uint32Array]"]=!0,A[l]=A[h]=A[$]=A[u]=A[C]=A[p]=A[d]=A[_]=A[g]=A[y]=A[w]=A[S]=A[v]=A[k]=A["[object WeakMap]"]=!1;var P="object"==typeof t&&t&&t.Object===Object&&t,L="object"==typeof self&&self&&self.Object===Object&&self,E=P||L||Function("return this")(),D="object"==typeof e&&e&&!e.nodeType&&e,V=D&&"object"==typeof s&&s&&!s.nodeType&&s,R=V&&V.exports===D,M=R&&P.process,N=function(){try{return M&&M.binding&&M.binding("util")}catch(t){}}(),F=N&&N.isTypedArray;function I(t,e){for(var s=-1,r=null==t?0:t.length;++s<r;)if(e(t[s],s,t))return!0;return!1}function W(t,e){return t.has(e)}function z(t){var e=-1,s=Array(t.size);return t.forEach(function(t,r){s[++e]=[r,t]}),s}function H(t){var e=-1,s=Array(t.size);return t.forEach(function(t){s[++e]=t}),s}var B=Array.prototype,G=Function.prototype,U=Object.prototype,K=E["__core-js_shared__"],X=G.toString,Y=U.hasOwnProperty,J=function(){var t=/[^.]+$/.exec(K&&K.keys&&K.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),Z=U.toString,q=RegExp("^"+X.call(Y).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Q=R?E.Buffer:void 0,tt=E.Symbol,et=E.Uint8Array,st=U.propertyIsEnumerable,rt=B.splice,it=tt?tt.toStringTag:void 0,nt=Object.getOwnPropertySymbols,ot=Q?Q.isBuffer:void 0,at=function(t,e){return function(s){return t(e(s))}}(Object.keys,Object),lt=Rt(E,"DataView"),ht=Rt(E,"Map"),ct=Rt(E,"Promise"),ut=Rt(E,"Set"),pt=Rt(E,"WeakMap"),dt=Rt(Object,"create"),_t=It(lt),ft=It(ht),gt=It(ct),yt=It(ut),mt=It(pt),wt=tt?tt.prototype:void 0,bt=wt?wt.valueOf:void 0;function St(t){var e=-1,s=null==t?0:t.length;for(this.clear();++e<s;){var r=t[e];this.set(r[0],r[1])}}function vt(t){var e=-1,s=null==t?0:t.length;for(this.clear();++e<s;){var r=t[e];this.set(r[0],r[1])}}function kt(t){var e=-1,s=null==t?0:t.length;for(this.clear();++e<s;){var r=t[e];this.set(r[0],r[1])}}function xt(t){var e=-1,s=null==t?0:t.length;for(this.__data__=new kt;++e<s;)this.add(t[e])}function jt(t){var e=this.__data__=new vt(t);this.size=e.size}function $t(t,e){var s=Ht(t),r=!s&&zt(t),i=!s&&!r&&Bt(t),n=!s&&!r&&!i&&Yt(t),o=s||r||i||n,a=o?function(t,e){for(var s=-1,r=Array(t);++s<t;)r[s]=e(s);return r}(t.length,String):[],l=a.length;for(var h in t)!e&&!Y.call(t,h)||o&&("length"==h||i&&("offset"==h||"parent"==h)||n&&("buffer"==h||"byteLength"==h||"byteOffset"==h)||Ft(h,l))||a.push(h);return a}function Ct(t,e){for(var s=t.length;s--;)if(Wt(t[s][0],e))return s;return-1}function Tt(t){return null==t?void 0===t?j:m:it&&it in Object(t)?function(t){var e=Y.call(t,it),s=t[it];try{t[it]=void 0;var r=!0}catch(t){}var i=Z.call(t);r&&(e?t[it]=s:delete t[it]);return i}(t):function(t){return Z.call(t)}(t)}function Ot(t){return Xt(t)&&Tt(t)==l}function At(t,e,s,r,i){return t===e||(null==t||null==e||!Xt(t)&&!Xt(e)?t!=t&&e!=e:function(t,e,s,r,i,a){var c=Ht(t),_=Ht(e),f=c?h:Nt(t),m=_?h:Nt(e),b=(f=f==l?w:f)==w,j=(m=m==l?w:m)==w,T=f==m;if(T&&Bt(t)){if(!Bt(e))return!1;c=!0,b=!1}if(T&&!b)return a||(a=new jt),c||Yt(t)?Et(t,e,s,r,i,a):function(t,e,s,r,i,a,l){switch(s){case C:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case $:return!(t.byteLength!=e.byteLength||!a(new et(t),new et(e)));case u:case p:case y:return Wt(+t,+e);case d:return t.name==e.name&&t.message==e.message;case S:case k:return t==e+"";case g:var h=z;case v:var c=r&n;if(h||(h=H),t.size!=e.size&&!c)return!1;var _=l.get(t);if(_)return _==e;r|=o,l.set(t,e);var f=Et(h(t),h(e),r,i,a,l);return l.delete(t),f;case x:if(bt)return bt.call(t)==bt.call(e)}return!1}(t,e,f,s,r,i,a);if(!(s&n)){var O=b&&Y.call(t,"__wrapped__"),A=j&&Y.call(e,"__wrapped__");if(O||A){var P=O?t.value():t,L=A?e.value():e;return a||(a=new jt),i(P,L,s,r,a)}}if(!T)return!1;return a||(a=new jt),function(t,e,s,r,i,o){var a=s&n,l=Dt(t),h=l.length,c=Dt(e).length;if(h!=c&&!a)return!1;for(var u=h;u--;){var p=l[u];if(!(a?p in e:Y.call(e,p)))return!1}var d=o.get(t);if(d&&o.get(e))return d==e;var _=!0;o.set(t,e),o.set(e,t);for(var f=a;++u<h;){p=l[u];var g=t[p],y=e[p];if(r)var m=a?r(y,g,p,e,t,o):r(g,y,p,t,e,o);if(!(void 0===m?g===y||i(g,y,s,r,o):m)){_=!1;break}f||(f="constructor"==p)}if(_&&!f){var w=t.constructor,b=e.constructor;w!=b&&"constructor"in t&&"constructor"in e&&!("function"==typeof w&&w instanceof w&&"function"==typeof b&&b instanceof b)&&(_=!1)}return o.delete(t),o.delete(e),_}(t,e,s,r,i,a)}(t,e,s,r,At,i))}function Pt(t){return!(!Kt(t)||function(t){return!!J&&J in t}(t))&&(Gt(t)?q:T).test(It(t))}function Lt(t){if(!function(t){var e=t&&t.constructor,s="function"==typeof e&&e.prototype||U;return t===s}(t))return at(t);var e=[];for(var s in Object(t))Y.call(t,s)&&"constructor"!=s&&e.push(s);return e}function Et(t,e,s,r,i,a){var l=s&n,h=t.length,c=e.length;if(h!=c&&!(l&&c>h))return!1;var u=a.get(t);if(u&&a.get(e))return u==e;var p=-1,d=!0,_=s&o?new xt:void 0;for(a.set(t,e),a.set(e,t);++p<h;){var f=t[p],g=e[p];if(r)var y=l?r(g,f,p,e,t,a):r(f,g,p,t,e,a);if(void 0!==y){if(y)continue;d=!1;break}if(_){if(!I(e,function(t,e){if(!W(_,e)&&(f===t||i(f,t,s,r,a)))return _.push(e)})){d=!1;break}}else if(f!==g&&!i(f,g,s,r,a)){d=!1;break}}return a.delete(t),a.delete(e),d}function Dt(t){return function(t,e,s){var r=e(t);return Ht(t)?r:function(t,e){for(var s=-1,r=e.length,i=t.length;++s<r;)t[i+s]=e[s];return t}(r,s(t))}(t,Jt,Mt)}function Vt(t,e){var s=t.__data__;return function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t}(e)?s["string"==typeof e?"string":"hash"]:s.map}function Rt(t,e){var s=function(t,e){return null==t?void 0:t[e]}(t,e);return Pt(s)?s:void 0}St.prototype.clear=function(){this.__data__=dt?dt(null):{},this.size=0},St.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},St.prototype.get=function(t){var e=this.__data__;if(dt){var s=e[t];return s===i?void 0:s}return Y.call(e,t)?e[t]:void 0},St.prototype.has=function(t){var e=this.__data__;return dt?void 0!==e[t]:Y.call(e,t)},St.prototype.set=function(t,e){var s=this.__data__;return this.size+=this.has(t)?0:1,s[t]=dt&&void 0===e?i:e,this},vt.prototype.clear=function(){this.__data__=[],this.size=0},vt.prototype.delete=function(t){var e=this.__data__,s=Ct(e,t);return!(s<0||(s==e.length-1?e.pop():rt.call(e,s,1),--this.size,0))},vt.prototype.get=function(t){var e=this.__data__,s=Ct(e,t);return s<0?void 0:e[s][1]},vt.prototype.has=function(t){return Ct(this.__data__,t)>-1},vt.prototype.set=function(t,e){var s=this.__data__,r=Ct(s,t);return r<0?(++this.size,s.push([t,e])):s[r][1]=e,this},kt.prototype.clear=function(){this.size=0,this.__data__={hash:new St,map:new(ht||vt),string:new St}},kt.prototype.delete=function(t){var e=Vt(this,t).delete(t);return this.size-=e?1:0,e},kt.prototype.get=function(t){return Vt(this,t).get(t)},kt.prototype.has=function(t){return Vt(this,t).has(t)},kt.prototype.set=function(t,e){var s=Vt(this,t),r=s.size;return s.set(t,e),this.size+=s.size==r?0:1,this},xt.prototype.add=xt.prototype.push=function(t){return this.__data__.set(t,i),this},xt.prototype.has=function(t){return this.__data__.has(t)},jt.prototype.clear=function(){this.__data__=new vt,this.size=0},jt.prototype.delete=function(t){var e=this.__data__,s=e.delete(t);return this.size=e.size,s},jt.prototype.get=function(t){return this.__data__.get(t)},jt.prototype.has=function(t){return this.__data__.has(t)},jt.prototype.set=function(t,e){var s=this.__data__;if(s instanceof vt){var i=s.__data__;if(!ht||i.length<r-1)return i.push([t,e]),this.size=++s.size,this;s=this.__data__=new kt(i)}return s.set(t,e),this.size=s.size,this};var Mt=nt?function(t){return null==t?[]:(t=Object(t),function(t,e){for(var s=-1,r=null==t?0:t.length,i=0,n=[];++s<r;){var o=t[s];e(o,s,t)&&(n[i++]=o)}return n}(nt(t),function(e){return st.call(t,e)}))}:function(){return[]},Nt=Tt;function Ft(t,e){return!!(e=null==e?a:e)&&("number"==typeof t||O.test(t))&&t>-1&&t%1==0&&t<e}function It(t){if(null!=t){try{return X.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function Wt(t,e){return t===e||t!=t&&e!=e}(lt&&Nt(new lt(new ArrayBuffer(1)))!=C||ht&&Nt(new ht)!=g||ct&&"[object Promise]"!=Nt(ct.resolve())||ut&&Nt(new ut)!=v||pt&&"[object WeakMap]"!=Nt(new pt))&&(Nt=function(t){var e=Tt(t),s=e==w?t.constructor:void 0,r=s?It(s):"";if(r)switch(r){case _t:return C;case ft:return g;case gt:return"[object Promise]";case yt:return v;case mt:return"[object WeakMap]"}return e});var zt=Ot(function(){return arguments}())?Ot:function(t){return Xt(t)&&Y.call(t,"callee")&&!st.call(t,"callee")},Ht=Array.isArray;var Bt=ot||function(){return!1};function Gt(t){if(!Kt(t))return!1;var e=Tt(t);return e==_||e==f||e==c||e==b}function Ut(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=a}function Kt(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function Xt(t){return null!=t&&"object"==typeof t}var Yt=F?function(t){return function(e){return t(e)}}(F):function(t){return Xt(t)&&Ut(t.length)&&!!A[Tt(t)]};function Jt(t){return function(t){return null!=t&&Ut(t.length)&&!Gt(t)}(t)?$t(t):Lt(t)}s.exports=function(t,e){return At(t,e)}}).call(this,s(0),s(1)(t))},function(t,e,s){(function(t,s){var r=200,i="__lodash_hash_undefined__",n=9007199254740991,o="[object Arguments]",a="[object Boolean]",l="[object Date]",h="[object Function]",c="[object GeneratorFunction]",u="[object Map]",p="[object Number]",d="[object Object]",_="[object RegExp]",f="[object Set]",g="[object String]",y="[object Symbol]",m="[object ArrayBuffer]",w="[object DataView]",b="[object Float32Array]",S="[object Float64Array]",v="[object Int8Array]",k="[object Int16Array]",x="[object Int32Array]",j="[object Uint8Array]",$="[object Uint8ClampedArray]",C="[object Uint16Array]",T="[object Uint32Array]",O=/\w*$/,A=/^\[object .+?Constructor\]$/,P=/^(?:0|[1-9]\d*)$/,L={};L[o]=L["[object Array]"]=L[m]=L[w]=L[a]=L[l]=L[b]=L[S]=L[v]=L[k]=L[x]=L[u]=L[p]=L[d]=L[_]=L[f]=L[g]=L[y]=L[j]=L[$]=L[C]=L[T]=!0,L["[object Error]"]=L[h]=L["[object WeakMap]"]=!1;var E="object"==typeof t&&t&&t.Object===Object&&t,D="object"==typeof self&&self&&self.Object===Object&&self,V=E||D||Function("return this")(),R="object"==typeof e&&e&&!e.nodeType&&e,M=R&&"object"==typeof s&&s&&!s.nodeType&&s,N=M&&M.exports===R;function F(t,e){return t.set(e[0],e[1]),t}function I(t,e){return t.add(e),t}function W(t,e,s,r){var i=-1,n=t?t.length:0;for(r&&n&&(s=t[++i]);++i<n;)s=e(s,t[i],i,t);return s}function z(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(t){}return e}function H(t){var e=-1,s=Array(t.size);return t.forEach(function(t,r){s[++e]=[r,t]}),s}function B(t,e){return function(s){return t(e(s))}}function G(t){var e=-1,s=Array(t.size);return t.forEach(function(t){s[++e]=t}),s}var U=Array.prototype,K=Function.prototype,X=Object.prototype,Y=V["__core-js_shared__"],J=function(){var t=/[^.]+$/.exec(Y&&Y.keys&&Y.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),Z=K.toString,q=X.hasOwnProperty,Q=X.toString,tt=RegExp("^"+Z.call(q).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),et=N?V.Buffer:void 0,st=V.Symbol,rt=V.Uint8Array,it=B(Object.getPrototypeOf,Object),nt=Object.create,ot=X.propertyIsEnumerable,at=U.splice,lt=Object.getOwnPropertySymbols,ht=et?et.isBuffer:void 0,ct=B(Object.keys,Object),ut=Rt(V,"DataView"),pt=Rt(V,"Map"),dt=Rt(V,"Promise"),_t=Rt(V,"Set"),ft=Rt(V,"WeakMap"),gt=Rt(Object,"create"),yt=Wt(ut),mt=Wt(pt),wt=Wt(dt),bt=Wt(_t),St=Wt(ft),vt=st?st.prototype:void 0,kt=vt?vt.valueOf:void 0;function xt(t){var e=-1,s=t?t.length:0;for(this.clear();++e<s;){var r=t[e];this.set(r[0],r[1])}}function jt(t){var e=-1,s=t?t.length:0;for(this.clear();++e<s;){var r=t[e];this.set(r[0],r[1])}}function $t(t){var e=-1,s=t?t.length:0;for(this.clear();++e<s;){var r=t[e];this.set(r[0],r[1])}}function Ct(t){this.__data__=new jt(t)}function Tt(t,e){var s=Ht(t)||function(t){return function(t){return function(t){return!!t&&"object"==typeof t}(t)&&Bt(t)}(t)&&q.call(t,"callee")&&(!ot.call(t,"callee")||Q.call(t)==o)}(t)?function(t,e){for(var s=-1,r=Array(t);++s<t;)r[s]=e(s);return r}(t.length,String):[],r=s.length,i=!!r;for(var n in t)!e&&!q.call(t,n)||i&&("length"==n||Ft(n,r))||s.push(n);return s}function Ot(t,e,s){var r=t[e];q.call(t,e)&&zt(r,s)&&(void 0!==s||e in t)||(t[e]=s)}function At(t,e){for(var s=t.length;s--;)if(zt(t[s][0],e))return s;return-1}function Pt(t,e,s,r,i,n,A){var P;if(r&&(P=n?r(t,i,n,A):r(t)),void 0!==P)return P;if(!Kt(t))return t;var E=Ht(t);if(E){if(P=function(t){var e=t.length,s=t.constructor(e);e&&"string"==typeof t[0]&&q.call(t,"index")&&(s.index=t.index,s.input=t.input);return s}(t),!e)return function(t,e){var s=-1,r=t.length;e||(e=Array(r));for(;++s<r;)e[s]=t[s];return e}(t,P)}else{var D=Nt(t),V=D==h||D==c;if(Gt(t))return function(t,e){if(e)return t.slice();var s=new t.constructor(t.length);return t.copy(s),s}(t,e);if(D==d||D==o||V&&!n){if(z(t))return n?t:{};if(P=function(t){return"function"!=typeof t.constructor||It(t)?{}:function(t){return Kt(t)?nt(t):{}}(it(t))}(V?{}:t),!e)return function(t,e){return Dt(t,Mt(t),e)}(t,function(t,e){return t&&Dt(e,Xt(e),t)}(P,t))}else{if(!L[D])return n?t:{};P=function(t,e,s,r){var i=t.constructor;switch(e){case m:return Et(t);case a:case l:return new i(+t);case w:return function(t,e){var s=e?Et(t.buffer):t.buffer;return new t.constructor(s,t.byteOffset,t.byteLength)}(t,r);case b:case S:case v:case k:case x:case j:case $:case C:case T:return function(t,e){var s=e?Et(t.buffer):t.buffer;return new t.constructor(s,t.byteOffset,t.length)}(t,r);case u:return function(t,e,s){return W(e?s(H(t),!0):H(t),F,new t.constructor)}(t,r,s);case p:case g:return new i(t);case _:return function(t){var e=new t.constructor(t.source,O.exec(t));return e.lastIndex=t.lastIndex,e}(t);case f:return function(t,e,s){return W(e?s(G(t),!0):G(t),I,new t.constructor)}(t,r,s);case y:return function(t){return kt?Object(kt.call(t)):{}}(t)}}(t,D,Pt,e)}}A||(A=new Ct);var R=A.get(t);if(R)return R;if(A.set(t,P),!E)var M=s?function(t){return function(t,e,s){var r=e(t);return Ht(t)?r:function(t,e){for(var s=-1,r=e.length,i=t.length;++s<r;)t[i+s]=e[s];return t}(r,s(t))}(t,Xt,Mt)}(t):Xt(t);return function(t,e){for(var s=-1,r=t?t.length:0;++s<r&&!1!==e(t[s],s,t););}(M||t,function(i,n){M&&(i=t[n=i]),Ot(P,n,Pt(i,e,s,r,n,t,A))}),P}function Lt(t){return!(!Kt(t)||function(t){return!!J&&J in t}(t))&&(Ut(t)||z(t)?tt:A).test(Wt(t))}function Et(t){var e=new t.constructor(t.byteLength);return new rt(e).set(new rt(t)),e}function Dt(t,e,s,r){s||(s={});for(var i=-1,n=e.length;++i<n;){var o=e[i],a=r?r(s[o],t[o],o,s,t):void 0;Ot(s,o,void 0===a?t[o]:a)}return s}function Vt(t,e){var s=t.__data__;return function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t}(e)?s["string"==typeof e?"string":"hash"]:s.map}function Rt(t,e){var s=function(t,e){return null==t?void 0:t[e]}(t,e);return Lt(s)?s:void 0}xt.prototype.clear=function(){this.__data__=gt?gt(null):{}},xt.prototype.delete=function(t){return this.has(t)&&delete this.__data__[t]},xt.prototype.get=function(t){var e=this.__data__;if(gt){var s=e[t];return s===i?void 0:s}return q.call(e,t)?e[t]:void 0},xt.prototype.has=function(t){var e=this.__data__;return gt?void 0!==e[t]:q.call(e,t)},xt.prototype.set=function(t,e){return this.__data__[t]=gt&&void 0===e?i:e,this},jt.prototype.clear=function(){this.__data__=[]},jt.prototype.delete=function(t){var e=this.__data__,s=At(e,t);return!(s<0||(s==e.length-1?e.pop():at.call(e,s,1),0))},jt.prototype.get=function(t){var e=this.__data__,s=At(e,t);return s<0?void 0:e[s][1]},jt.prototype.has=function(t){return At(this.__data__,t)>-1},jt.prototype.set=function(t,e){var s=this.__data__,r=At(s,t);return r<0?s.push([t,e]):s[r][1]=e,this},$t.prototype.clear=function(){this.__data__={hash:new xt,map:new(pt||jt),string:new xt}},$t.prototype.delete=function(t){return Vt(this,t).delete(t)},$t.prototype.get=function(t){return Vt(this,t).get(t)},$t.prototype.has=function(t){return Vt(this,t).has(t)},$t.prototype.set=function(t,e){return Vt(this,t).set(t,e),this},Ct.prototype.clear=function(){this.__data__=new jt},Ct.prototype.delete=function(t){return this.__data__.delete(t)},Ct.prototype.get=function(t){return this.__data__.get(t)},Ct.prototype.has=function(t){return this.__data__.has(t)},Ct.prototype.set=function(t,e){var s=this.__data__;if(s instanceof jt){var i=s.__data__;if(!pt||i.length<r-1)return i.push([t,e]),this;s=this.__data__=new $t(i)}return s.set(t,e),this};var Mt=lt?B(lt,Object):function(){return[]},Nt=function(t){return Q.call(t)};function Ft(t,e){return!!(e=null==e?n:e)&&("number"==typeof t||P.test(t))&&t>-1&&t%1==0&&t<e}function It(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||X)}function Wt(t){if(null!=t){try{return Z.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function zt(t,e){return t===e||t!=t&&e!=e}(ut&&Nt(new ut(new ArrayBuffer(1)))!=w||pt&&Nt(new pt)!=u||dt&&"[object Promise]"!=Nt(dt.resolve())||_t&&Nt(new _t)!=f||ft&&"[object WeakMap]"!=Nt(new ft))&&(Nt=function(t){var e=Q.call(t),s=e==d?t.constructor:void 0,r=s?Wt(s):void 0;if(r)switch(r){case yt:return w;case mt:return u;case wt:return"[object Promise]";case bt:return f;case St:return"[object WeakMap]"}return e});var Ht=Array.isArray;function Bt(t){return null!=t&&function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=n}(t.length)&&!Ut(t)}var Gt=ht||function(){return!1};function Ut(t){var e=Kt(t)?Q.call(t):"";return e==h||e==c}function Kt(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function Xt(t){return Bt(t)?Tt(t):function(t){if(!It(t))return ct(t);var e=[];for(var s in Object(t))q.call(t,s)&&"constructor"!=s&&e.push(s);return e}(t)}s.exports=function(t){return Pt(t,!0,!0)}}).call(this,s(0),s(1)(t))},function(t,e,s){"use strict";s.r(e);const r="smart_cities_";class i{constructor(t){this.scene=t,this.audioPlayer=this.scene.audioPlayer;const e=this.scene.assetRoot;this.assets={birds:{type:"spritesheet",path:`${e}${r}birds.png`,frameHeight:15,frameWidth:13},blue_player:{type:"spritesheet",path:`${e}${r}blue_player.png`,frameHeight:45,frameWidth:20},pink_player:{type:"spritesheet",path:`${e}${r}pink_player.png`,frameHeight:45,frameWidth:20},orange_cyclist:{type:"spritesheet",path:`${e}${r}orange_cyclist.png`,frameHeight:55,frameWidth:50},green_cyclist:{type:"spritesheet",path:`${e}${r}green_cyclist.png`,frameHeight:55,frameWidth:50},cloud_large:{type:"image",path:`${e}${r}cloud_large.png`},cloud_small:{type:"image",path:`${e}${r}cloud_small.png`},door_blue:{type:"image",path:`${e}${r}door_blue.png`},door_pink:{type:"image",path:`${e}${r}door_pink.png`},fridge_on:{type:"image",path:`${e}${r}fridge_on.png`},hills:{type:"image",path:`${e}${r}hills.png`},house:{type:"image",path:`${e}${r}house.png`},pavement:{type:"image",path:`${e}${r}pavement.png`},porch_light_on_light:{type:"image",path:`${e}${r}porch_light_on_light.png`},porch_light_beam:{type:"image",path:`${e}${r}porch_light_beam.png`},porch_light_on:{type:"image",path:`${e}${r}porch_light_on.png`},porch_light_off:{type:"image",path:`${e}${r}porch_light_off.png`},road:{type:"image",path:`${e}${r}road.png`},solar_panel:{type:"image",path:`${e}${r}solar_panel.png`},solar_panel_on:{type:"image",path:`${e}${r}solar_panel_on.png`},streetlamp_on:{type:"image",path:`${e}${r}streetlamp_on.png`},streetlamp_off:{type:"image",path:`${e}${r}streetlamp_off.png`},streetlamp_modern_light_beam:{type:"image",path:`${e}${r}streetlamp_modern_light_beam.png`},streetlamp_modern_on_post:{type:"image",path:`${e}${r}streetlamp_modern_on_post.png`},streetlamp_modern_on:{type:"image",path:`${e}${r}streetlamp_modern_on.png`},streetlamp_modern_off:{type:"image",path:`${e}${r}streetlamp_modern_off.png`},windmill_tower:{type:"image",path:`${e}${r}windmill_tower.png`},windmill_turbine:{type:"image",path:`${e}${r}windmill_turbine.png`},turbine_0:{type:"image",path:`${e}${r}windmill_turbine_0.png`},turbine_1:{type:"image",path:`${e}${r}windmill_turbine_1.png`},turbine_2:{type:"image",path:`${e}${r}windmill_turbine_2.png`},turbine_3:{type:"image",path:`${e}${r}windmill_turbine_3.png`},window:{type:"image",path:`${e}${r}window.png`},window_lights:{type:"image",path:`${e}${r}window_lights.png`},window_small:{type:"image",path:`${e}${r}window_small.png`},window_small_lights:{type:"image",path:`${e}${r}window_small_lights.png`},failure_sound:{type:"sound",ogg:`${e}tl_failure_kenny_musicJingles_jingles_PIZZI11.ogg`,mp3:`${e}tl_failure_kenny_musicJingles_jingles_PIZZI11.mp3`},success_sound:{type:"sound",ogg:`${e}tl_success_kenny_musicJingles_jingles_STEEL10.ogg`,mp3:`${e}tl_success_kenny_musicJingles_jingles_STEEL10.mp3`}},this.assetPacks={allAssets:["birds","blue_player","pink_player","orange_cyclist","green_cyclist","cloud_large","cloud_small","door_blue","door_pink","fridge_on","hills","house","pavement","porch_light_on_light","porch_light_beam","porch_light_on","porch_light_off","road","solar_panel","solar_panel_on","streetlamp_modern_light_beam","streetlamp_modern_on_post","streetlamp_on","streetlamp_off","streetlamp_modern_on","streetlamp_modern_off","windmill_tower","windmill_turbine","turbine_0","turbine_1","turbine_2","turbine_3","window","window_lights","window_small","window_small_lights","success_sound","failure_sound"]}}loadPacks(t){t.forEach(t=>{this.loadPack(t)})}loadPack(t){let e=this.assetPacks[t];this.loadAssets(e)}loadAssets(t){t.forEach(t=>{let e=this.assets[t];this.loadAsset(t,e)})}loadAsset(t,e){switch(e.type){case"image":this.scene.load.image(t,e.path);break;case"spritesheet":this.scene.load.spritesheet(t,e.path,{frameWidth:e.frameWidth,frameHeight:e.frameHeight});break;case"sound":this.scene.load.audio(t,[e.ogg,e.mp3]),this.audioPlayer.register({id:t,mp3:e.mp3,ogg:e.ogg});break;default:throw`Asset ${t} needs config.type set in configuration.`}}}let n=window.Phaser;const o=(t,e,s)=>"-1"!=s?`${t} ${e}${s}`:`${t} ${e}`;class a extends n.GameObjects.Text{constructor(t,e,s,r,i,n,a){super(t,e,s,o(r,i,a),n),this.scene=t,this.state=r,this.value=i,this.ending=a}setValue(t){this.value=t,this.updateValueText()}increment(t){this.setValue(this.value+t)}updateValueText(){this.setText(o(this.state,this.value,this.ending))}hideText(){this.setVisible(!1)}showText(){this.setVisible(!0)}flashText(){this.alpha=1,this.scene.tweens.add({targets:this,alpha:0,duration:1e3,delay:300,hold:300,repeat:-1,yoyo:!0})}}var l=s(2),h=s.n(l),c=s(3),u=s.n(c);class p{constructor(t,e,s,r,i,n,o){this.scene=t,this.key=e,this.x=s,this.y=r,this.offset=i,this.onState=n,this.conversionRate=o,this.energy=void 0}get isOn(){return this.onState}turnOn(){this.onState=!0}turnOff(){this.onState=!1}createEnergy(t){return this.energy=t*this.conversionRate,this.energy}}class d extends p{constructor(t,e,s,r,i,n){super(t,e,s,r,i,n,.003),this.scene=t,this.turbine=this.createTurbine(),this.sprite=this.setupSprite()}createTurbine(){let t=this.scene.add.image(this.x,this.y,"windmill_turbine").setOrigin(this.offset.x,this.offset.y);return t.setScale(this.scene.worldScale,this.scene.worldScale),t.rotation+=50*Math.random(),t}rotateTurbines(t,e){let s=t*(e/90*.0045);e<8?this.turbine.setTexture("turbine_0"):e<30?this.turbine.setTexture("turbine_1"):e<70?this.turbine.setTexture("turbine_2"):this.turbine.setTexture("turbine_3"),this.onState&&(this.turbine.rotation+=s),s!=scene.blade_speed&&(scene.blade_speed=s)}setupSprite(){let t=this.scene.add.group(),e=this.scene.add.image(this.x,this.y,"windmill_tower").setOrigin(this.offset.x,this.offset.y);return e.setScale(this.scene.worldScale,this.scene.worldScale),t.add(e),t.add(this.turbine),t}}class _ extends p{constructor(t,e,s,r,i,n){super(t,e,s,r,i,n,.004),this.scene=t,this.onKey="solar_panel_on",this.offKey="solar_panel",this.sprite=this.setupSprite()}setupSprite(){let t=this.onState?this.onKey:this.offKey,e=this.scene.add.image(this.x,this.y,t).setOrigin(this.offset.x,this.offset.y);return e.setScale(this.scene.worldScale,this.scene.worldScale),e}turnOn(){this.onState=!0,this.update()}turnOff(){this.onState=!1,this.update()}update(){this.onState?this.sprite.setTexture(this.onKey):this.sprite.setTexture(this.offKey)}}class f{constructor(t,e,s,r,i,n,o,a,l,h){this.scene=t,this.key=e,this.x=s,this.y=r,this.offset=i,this.onState=l,this.energyConsumption=h,this.energy=void 0,this.onKey=n,this.offKey=o,this.lightKey=a,this.lowPowerState=!1,this.lightHolder=this.createLightHolder(),this.light=this.createLight(),this.sprite=this.setupSprite(),this.recentNearestDistance=-1}createLight(){let t=this.scene.add.image(this.x,this.y,this.lightKey).setOrigin(this.offset.x,this.offset.y);return t.setScale(this.scene.worldScale,this.scene.worldScale),this.onState||t.setVisible(!1),t}createLightHolder(){let t=this.onState?this.onKey:this.offKey,e=this.scene.add.image(this.x,this.y,t).setOrigin(this.offset.x,this.offset.y);return e.setScale(this.scene.worldScale,this.scene.worldScale),e}setupSprite(){let t=this.scene.add.group();return t.add(this.lightHolder),t.add(this.light),t}update(){this.onState?this.lightHolder.setTexture(this.onKey):this.lightHolder.setTexture(this.offKey)}get isOn(){return this.onState}get isLowPower(){return this.lowPowerState}get consumptionRate(){return this.energyConsumption}turnOn(){this.onState=!0,this.lowPowerState=!1,this.light.setVisible(!0),this.light.setTint(this.scene.Phaser.Display.Color.GetColor(255,255,255)),this.update()}turnOff(){this.onState=!1,this.lowPowerState=!1,this.light.setVisible(!1),this.update()}lowPower(){this.lowPowerState=!0,this.onState=!0,this.light.setVisible(!0),this.light.setTint(this.scene.Phaser.Display.Color.GetColor(240,230,230)),this.update()}setColour(t,e,s){this.light.setTint(this.scene.Phaser.Display.Color.GetColor(t,e,s)),this.turnOn()}getProximity(t){if(t.x>=this.x&&t.x<=this.x+this.lightHolder.displayWidth)return 0;return Math.min(Math.abs(this.x-t.x),Math.abs(this.x+this.lightHolder.displayWidth-t.x))}getNearestDistance(t,e=!1){let s=400;return e?(t.forEach(t=>{let e=this.getProximity(t.sprite);e<s&&(s=e)}),this.recentNearestDistance=s):e||-1!=this.recentNearestDistance?s=this.recentNearestDistance:t.forEach(t=>{let e=this.getProximity(t.sprite);e<s&&(s=e)}),Math.round(s)}getNearestPlayer(t){let e=400,s=void 0;return t.forEach(t=>{if("cyclist"!=t.type){let r=this.getProximity(this.sprite,t.sprite);r<e&&(e=r,s=t.sprite)}}),s}getEnergyConsumed(){return this.onState?this.energyConsumption:0}useEnergy(t){return t>this.energyConsumption?this.energyConsumption:(this.onState=!1,0)}}class g extends f{constructor(t,e,s,r,i,n,o,a,l){super(t,e,s,r,i,n,o,a,l,12)}}class y extends f{constructor(t,e,s,r,i,n,o,a,l){super(t,e,s,r,i,n,o,a,l,2)}}class m extends f{constructor(t,e,s,r,i,n,o,a,l){super(t,e,s,r,i,n,o,a,l,12)}}class w{constructor(t){this.key="Sensor",this.scene=t,this.dawn=8,this.dusk=19,this.darkLums=16,this.lightLums=10}get wind(){return this.scene.wind}get light(){return this.scene.light}get time(){return this.scene.worldTime}get isWindy(){return this.scene.wind>=10}get isFlat(){return this.scene.wind<10}get isLight(){return this.scene.light>=this.lightLums}get isDark(){return this.scene.light<=this.darkLums}get isEvening(){return this.scene.time>=this.dusk}get isDaytime(){return this.scene.time>=this.dusk&&this.scene.time<=this.dawn}}class b{constructor(t){this.key="Battery",this.maxCapacity=400,this.filling=!1,this.using=!1,this.energy=t}get energyValue(){return this.energy}get isFilling(){return this.filling}get isUsing(){return this.using}get isFull(){return this.energy>=this.maxCapacity}get isEmpty(){return 0==this.energy}charge(t){this.isFull||(this.energy+=t)}use(t){this.isEmpty||(this.energy-=t)}}let S=window.Phaser;class v extends S.Scene{constructor(){super({key:"CityScene"}),this.API=h.a.get(this),this.verificationAPI=u.a.get(this),this.camera=void 0,this.Phaser=S,this.status="setup",this.dawn=5,this.dusk=21,this.sunrise=7,this.sunset=19,this.hoursProgress=0,this.width=400,this.height=400,this.street=void 0,this.windmills=void 0,this.streetlamps=void 0,this.battery=void 0,this.blade_speed=null,this.blade_speed_max=.06,this.low_power=!1,this.max_wind_reached=!1,this.light=void 0,this.wind=void 0,this.worldTime=void 0,this.lightLabel=void 0,this.windLabel=void 0,this.timeLabel=void 0,this.energyConsumedLabel=void 0,this.recordState=[],this.cursors=void 0,this.studentCodeRunning=!1,this.completed=void 0,this.bot_direction=void 0,this.players=[],this.errorThrown=!1,this.worldScale=1}init(t){this.initConfig={audioPlayer:t.audioPlayer,timeStates:t.timeStates,weatherStates:{wind:t.weatherStates.wind,light:t.weatherStates.light},sceneSetup:t.sceneSetup,battery:t.battery,onStates:t.onStates,player:t.player,studentCode:t.studentCode,onComplete:t.onComplete,verificationFunction:t.verificationFunction,worldScale:t.worldScale},this.worldScale=t.worldScale||1,this.audioPlayer=t.audioPlayer,this.assetRoot=t.assetRoot||"assets/",this.onStates=t.onStates,this.onStates={windmills:t.onStates.includes("windmills"),streetlamps:t.onStates.includes("streetlamps"),porch_lights:t.onStates.includes("porch_lights"),window_lights:t.onStates.includes("window_lights"),solar_panels:t.onStates.includes("solar_panels")},this.startTime=t.timeStates[0],this.endTime=t.timeStates[1],this.timeScale=t.timeStates[2],this.sceneSetup=t.sceneSetup,this.wind=t.weatherStates.wind,this.blade_pitch=this.getLogicalBladeAngle(),this.worldTime=t.timeStates[0],this.time_light_map=[0,0,0,0,0,10,200,400,800,1600,3200,6400,12800,12800,12800,6400,3200,1600,800,400,200,10,0,0],this.light=t.weatherStates.light?this.time_light_map[this.worldTime]:t.weatherStates.light;let e=t.battery[0]||20;this.battery=new b(e),this.batteryLabel=t.battery[1],this.energyConsumedLabel=t.battery[2],this.energyConsumed=0,this.studentCode=t.studentCode,this.onComplete=t.onComplete,this.verificationFunction=t.verificationFunction,this.directions=[-1,1],this.bot_direction=this.directions[Math.floor(Math.random()*this.directions.length)],this.pink_player={key:"pink_player",x:Math.floor(300*Math.random())+50,y:105-105*this.worldScale+295,initDirection:this.bot_direction,type:"pink_player"==t.player?"player":"bot",active:t.sceneSetup.includes("pink_player")},this.blue_player={key:"blue_player",x:Math.floor(300*Math.random())+50,y:100-100*this.worldScale+300,initDirection:this.bot_direction,type:"blue_player"==t.player?"player":"bot",active:t.sceneSetup.includes("blue_player")},this.orange_cyclist={key:"orange_cyclist",x:Math.floor(300*Math.random())+50,y:60-60*this.worldScale+340,direction:1,type:"cyclist",velocity:100*this.worldScale,active:t.sceneSetup.includes("orange_cyclist")},this.green_cyclist={key:"green_cyclist",x:Math.floor(300*Math.random())+50,y:40-40*this.worldScale+360,direction:-1,type:"cyclist",velocity:140*this.worldScale,active:t.sceneSetup.includes("green_cyclist")},this.errorStates={worldTime:!1,light:!1,dark:!1,wind:!1,streetlamps:!1,porch_lights:!1,solar_panels:!1,blade_pitch:!1,low_power:!1,byId:{streetlamps:!1,porch_lights:!1,solar_panels:!1},proximities:{streetlamps:!1,porch_lights:!1},low_power_by_id:{streetlamps:!1,porch_lights:!1},no_houses:!1,no_streetlamps:!1}}getLogicalBladeAngle(){return this.wind<10?90:this.wind<20?60:this.wind<27?45:this.wind<40?30:0}preload(){this.assetLoader=new i(this),this.assetLoader.loadPack("allAssets")}create(){this.camera=this.cameras.add(0,0,400,400);let t=150-150*this.worldScale+250;this.hills=this.add.image(0,t,"hills").setOrigin(0,1),this.birds=this.createBirds(),this.street=this.createStreet(),this.houses=this.createHouses(),this.windmills=!!this.sceneSetup.includes("windmills")&&this.createWindmills(),this.setupPlayers([this.pink_player,this.blue_player]),this.streetlamps=!!this.sceneSetup.includes("streetlamps")&&this.createStreetlamps(),this.setupPlayers([this.orange_cyclist,this.green_cyclist]),"number"==typeof this.light?this.lightLabel=this.createStateLabel(16,380,"Light (lx):",this.light):(this.lightLabel=null,this.light=this.time_light_map[this.worldTime]),"number"==typeof this.wind?(this.windLabel=this.createStateLabel(285,380,"Wind (kn):",this.wind),this.wind_pattern=1):(this.windLabel=null,this.wind=10,this.blade_pitch=30,this.wind_pattern=0),this.batteryLabel=!!this.batteryLabel&&this.createStateLabel(200,355,"Battery (W):",this.battery.energyValue),this.energyConsumedLabel=!!this.energyConsumedLabel&&this.createStateLabel(200,375,"Energy Consumed (kWh):",this.energyConsumed),this.timeLabel=this.createStateLabel(310,16,"Time:","--","big"),this.lowPowerLabel=this.createStateLabel(10,10,"","Low Power"),this.turbineDamage=this.createStateLabel(10,10,"","Turbine Damage"),this.lowPowerLabel.hideText(),this.turbineDamage.hideText(),this.turbineDamage.flashText(),this.lowPowerLabel.flashText(),this.cursors=this.input.keyboard.createCursorKeys(),this.sensor=new w(this),this.failureSound=this.sound.add("failure_sound"),this.successSound=this.sound.add("success_sound"),this.addOnceListners(),[this.pink_player,this.blue_player,this.orange_cyclist,this.green_cyclist].forEach(t=>{t.active&&this.players.push(t)}),this.status="running"}addOnceListners(){this.events.once("onDefault",()=>{this.defaultEnd()},this),this.events.once("onSuccess",()=>{this.audioPlayer.play("success_sound",{volume:.3}),this.successfullAttempt()},this),this.events.once("onFailure",()=>{this.audioPlayer.play("failure_sound",{volume:.3}),this.failedAttempt()},this)}setupPlayers(t){t.forEach(t=>{t.active&&("cyclist"==t.type?t.sprite=this.createCyclist(t):t.sprite=this.createPlayer(t))})}createStreet(){let t=this.physics.add.staticGroup(),e=50-50*this.worldScale+350;return t.create(0,400,"road").setOrigin(0,1),t.create(0,e,"pavement").setOrigin(0,1).setScale(1,this.worldScale),t}createHouses(){let t={houses:[]};t.group=this.add.group();let e=50*this.worldScale,s=100-100*this.worldScale+300,r=100*this.worldScale,i=150*this.worldScale;this.noHouses=Math.floor((400-2*e)/r),e=(390-r*this.noHouses)/2;let n=i/150;for(let i=0;i<this.noHouses;i++){let o={};o.bricks=t.group.create(e+r*i,s,"house").setOrigin(0,1),o.bricks.setScale(this.worldScale,this.worldScale),this.sceneSetup.includes("solar_panels")&&(o.solar_panel=new _(this,"solar_panel",e+70*this.worldScale+r*i,s-105*this.worldScale+n,{x:0,y:1},this.onStates.solar_panels)),o.window=new m(this,"window_lights",e+15*this.worldScale+r*i,s-55*this.worldScale+n,{x:0,y:1},"window","window","window_lights",this.onStates.window_lights),o.window_small=new m(this,"window_lights",e+30*this.worldScale+r*i,s-15*this.worldScale+n,{x:0,y:1},"window_small","window_small","window_small_lights",this.onStates.window_lights),o.door=t.group.create(e+65*this.worldScale+r*i,s,"door_pink").setOrigin(0,1),o.door.setScale(this.worldScale,this.worldScale),o.porch_light=new y(this,"porch_light",e+58*this.worldScale+r*i,s-46*this.worldScale+n,{x:.5,y:.5},"porch_light_on_light","porch_light_off","porch_light_beam",this.onStates.porch_lights),t.houses.push(o)}return t.all=((e,s,r=[])=>{t.houses.forEach(t=>{r!=[]?t[e][s](...r):t[e][s]()})}),t}createStreetlamps(){let t={streetlamps:[]};t.group=this.add.group();let e={x:5,y:50-50*this.worldScale+350},s=(390-90*this.worldScale)/(this.noHouses-1);this.streetlampCoords=[];for(let r=0;r<this.noHouses;r++){let i=new g(this,"streetlamp",e.x+r*s,e.y,{x:0,y:1},"streetlamp_modern_on_post","streetlamp_modern_off","streetlamp_modern_light_beam",this.onStates.streetlamps);this.streetlampCoords.push({x:e.x+r*s,y:e.y}),t.streetlamps.push(i),t.group.add(i.sprite)}return t.all=((e,s=[])=>{t.streetlamps.forEach(t=>{s!=[]?t[e](...s):t[e]()})}),t}scaled(t){return t+(400-t-(400-t)*this.worldScale)}createWindmills(){let t={windmills:[]};t.group=this.add.group(),t.turbineGroup=this.add.group();let e=[];for(let t=0;t<this.noHouses;t++){let t={x:250*Math.random(),y:this.scaled(70)+40*Math.random()};e.push(t)}let s=30,r=-36,i={x:.476,y:.365};for(let n=0;n<this.noHouses;n++){let o=new d(this,"windmill",e[n].x+s,e[n].y+r,i,!0);t.windmills.push(o),t.group.add(o.sprite),t.turbineGroup.add(o.turbine)}return t.all=((e,s=[])=>{t.windmills.forEach(t=>{s!=[]?t[e](...s):t[e]()})}),t}createBirds(){const t=this.physics.add.group({key:"birds",repeat:Math.floor(4*Math.random()),setXY:{x:100,y:300-300*this.worldScale+75,stepX:10*Math.random()+10,stepY:10*Math.random()+10}});return this.anims.create({key:"bird_fly",frames:this.anims.generateFrameNumbers("birds",{start:0,end:9}),frameRate:10,repeat:-1}),t}createCyclist(t){let e=this.physics.add.sprite(t.x,t.y,t.key);return e.setScale(this.worldScale,this.worldScale),e.body.gravity.y=0,this.anims.create({key:`${t.key}_ride`,frames:this.anims.generateFrameNumbers(t.key,{start:0,end:3}),frameRate:10,repeat:-1}),this.anims.create({key:`${t.key}_celebrate`,frames:this.anims.generateFrameNumbers(t.key,{frames:[4,5,4,5]}),frameRate:10,repeat:2}),this.anims.create({key:`${t.key}_slump`,frames:this.anims.generateFrameNumbers(t.key,{frames:[0,6,7]}),frameRate:10}),e}createPlayer(t){let e=this.physics.add.sprite(t.x,t.y,t.key);return e.setScale(this.worldScale,this.worldScale),e.body.gravity.y=0,this.anims.create({key:`${t.key}_left`,frames:this.anims.generateFrameNumbers(t.key,{start:0,end:3}),frameRate:10,repeat:-1}),this.anims.create({key:`${t.key}_turn`,frames:[{key:t.key,frame:4}],frameRate:20}),this.anims.create({key:`${t.key}_right`,frames:this.anims.generateFrameNumbers(t.key,{start:5,end:8}),frameRate:10,repeat:-1}),this.anims.create({key:`${t.key}_celebrate`,frames:this.anims.generateFrameNumbers(t.key,{start:9,end:13}),frameRate:10,repeat:2}),e.on(S.Animations.Events.ANIMATION_COMPLETE_KEY+`${t.key}_celebrate`,function(){this.scene.pause()},this),this.anims.create({key:`${t.key}_slump`,frames:this.anims.generateFrameNumbers(t.key,{start:13,end:15}),frameRate:10}),e.on(S.Animations.Events.ANIMATION_COMPLETE_KEY+`${t.key}_slump`,function(){this.scene.pause()},this),e}createStateLabel(t,e,s,r,i="small",n=-1){const o=new a(this,t,e,s,r,"big"==i?{fontSize:"18px",fill:"#fff"}:{fontSize:"13px",fill:"#fff"},n);return this.add.existing(o),o}drawClock(t){this.timeLabel.setValue(`${t}`)}updateLight(){this.worldTime<=this.dawn||this.worldTime>=this.dusk?this.light=0:this.worldTime==this.sunrise||this.worldTime==this.sunset?this.light=400:this.worldTime<=12?this.light=2*this.light:this.worldTime>=14&&(this.light=this.light/2),this.lightLabel&&this.lightLabel.setValue(this.light)}updateWind(){this.wind>=40&&(this.max_wind_reached=!0);let t=0==this.wind_pattern?.25:3;this.max_wind_reached?this.wind-t>=0&&(this.wind-=t):this.wind+=t,this.wind<=3&&(this.max_wind_reached=!1),this.windLabel&&this.windLabel.setValue(this.wind)}changeWorldShade(t){var e=S.Display.Color.ValueToColor("#0F2F3A"),s=S.Display.Color.ValueToColor("#38C1FF"),r="#38C1FF",i=new S.Display.Color(150,150,150),n=new S.Display.Color(255,255,255),o=n;t<this.sunrise&&(r=S.Display.Color.Interpolate.ColorWithColor(e,s,this.sunrise,t),o=S.Display.Color.Interpolate.ColorWithColor(i,n,this.sunrise,t)),t>this.sunset&&(r=S.Display.Color.Interpolate.ColorWithColor(s,e,24-this.sunset,t-this.sunset),o=S.Display.Color.Interpolate.ColorWithColor(n,i,24-this.sunset,t-this.sunset)),this.houses.group.setTint(S.Display.Color.GetColor(o.r,o.g,o.b)),this.street.setTint(S.Display.Color.GetColor(o.r,o.g,o.b)),this.hills.setTint(S.Display.Color.GetColor(o.r,o.g,o.b)),this.windmills&&this.windmills.group.setTint(S.Display.Color.GetColor(o.r,o.g,o.b)),this.players.forEach(t=>{this.tintPlayer(t.sprite,o)});for(let t=0;t<this.noHouses;t++){let e=this.houses.houses[t];if(e.porch_light.isOn?e.porch_light.sprite.setTint(S.Display.Color.GetColor(255,255,255)):e.porch_light.sprite.setTint(S.Display.Color.GetColor(o.r,o.g,o.b)),e.window.isOn?(e.window.sprite.setTint(S.Display.Color.GetColor(255,255,255)),e.window_small.sprite.setTint(S.Display.Color.GetColor(255,255,255))):(e.window.sprite.setTint(S.Display.Color.GetColor(o.r,o.g,o.b)),e.window_small.sprite.setTint(S.Display.Color.GetColor(o.r,o.g,o.b))),this.streetlamps){let e=this.streetlamps.streetlamps[t];!this.onStates.streetlamps&&e?e.lightHolder.setTint(S.Display.Color.GetColor(o.r,o.g,o.b)):this.streetlamps&&this.onStates.streetlamps&&e.lightHolder.setTint(S.Display.Color.GetColor(255,255,255))}}this.camera.setBackgroundColor(r)}tintPlayer(t,e){this.isUnderOnStreetlamp(t)?t.setTint(S.Display.Color.GetColor(210,210,210)):t.setTint(S.Display.Color.GetColor(e.r,e.g,e.b))}isUnderOnStreetlamp(t){let e=90*this.worldScale,s=!1;return this.streetlamps&&(s=this.streetlampCoords.some(s=>{if(t.x>=s.x&&t.x<=s.x+e&&this.onStates.streetlamps)return!0})),!!s}setState(t,e){this.onStates[t]=e}isUpdateWorldTime(t){let e=60*(this.endTime-this.startTime)*t.getOverallProgress();return this.hoursProgress=Math.round(e/60),this.worldTime<this.startTime+this.hoursProgress}updateEnergyValues(){let t=[];this.houses.houses.forEach(e=>{t.push(e.porch_light),t.push(e.window),t.push(e.window_small)}),this.streetlamps&&this.streetlamps.streetlamps.forEach(e=>{t.push(e)});let e=0;t.forEach(t=>{e+=t.getEnergyConsumed()}),this.energyConsumed=e,this.energyConsumedLabel&&this.energyConsumedLabel.setValue(this.energyConsumed),this.battery.use(e),this.batteryLabel&&this.batteryLabel.setValue(this.battery.energyValue)}tick(){try{this.studentCode(this.API)}catch(t){this.errorThrown=!0,this.endWithError()}let t={worldTime:this.worldTime,light:this.light,wind:this.wind,streetlamps:this.onStates.streetlamps,porch_lights:this.onStates.porch_lights,solar_panels:this.onStates.solar_panels,window_lights:this.onStates.window_lights,blade_pitch:this.blade_pitch,low_power:this.low_power,byId:{streetlamps:this.streetlamps.streetlamps?Object.freeze(this.streetlamps.streetlamps.map(t=>t.isOn)):null,porch_lights:this.houses.houses[0].porch_light?Object.freeze(this.houses.houses.map(t=>t.porch_light.isOn)):null,solar_panels:this.houses.houses[0].solar_panel?Object.freeze(this.houses.houses.map(t=>t.solar_panel.isOn)):null},proximities:{streetlamps:this.streetlamps.streetlamps?Object.freeze(this.streetlamps.streetlamps.map(t=>t.getNearestDistance(scene.players))):null,porch_lights:this.houses.houses[0].porch_light?Object.freeze(this.houses.houses.map(t=>t.porch_light.getNearestDistance(scene.players))):null},low_power_by_id:{streetlamps:this.streetlamps.streetlamps?Object.freeze(this.streetlamps.streetlamps.map(t=>t.isLowPower)):null,porch_lights:this.houses.houses[0].porch_light?Object.freeze(this.houses.houses.map(t=>t.porch_light.isLowPower)):null}};this.recordState.push(t),this.worldTime=this.startTime+this.hoursProgress,this.updateLight(),this.updateWind(),this.updateEnergyValues(),this.drawClock(this.worldTime),this.worldTime==this.endTime&&this.endAttempt()}cursorAnimations(t){this.cursors.left.isDown?(t.sprite.setVelocityX(-80),t.sprite.anims.play(`${t.key}_left`,!0)):this.cursors.right.isDown?(t.sprite.setVelocityX(80),t.sprite.anims.play(`${t.key}_right`,!0)):(t.sprite.setVelocityX(0),t.sprite.anims.play(`${t.key}_turn`)),this.cursors.up.isDown&&t.sprite.body.touching.down&&t.sprite.setVelocityY(-330)}startAttempt(){this.worldTime=this.startTime,this.errorThrown=!1,this.resetValues(),this.recordState=[],this.addOnceListners(),this.timerEvent=this.time.addEvent({delay:5e3,timeScale:this.timeScale}),this.status="running",this.studentCodeRunning=!0}resetAttempt(){this.status="resetting",this.errorThrown=!1,this.players=[],this.resetValues(),this.scene.restart(this.initConfig),this.status="running",this.studentCodeRunning=!1,this.timerEvent=this.time.addEvent({delay:5e3,timeScale:this.timeScale})}resetValues(){this.low_power=!1,this.max_wind_reached=!1,this.onStates={windmills:this.initConfig.onStates.includes("windmills"),streetlamps:this.initConfig.onStates.includes("streetlamps"),porch_lights:this.initConfig.onStates.includes("porch_lights"),window_lights:this.initConfig.onStates.includes("window_lights"),solar_panels:this.initConfig.onStates.includes("solar_panels")},this.light=this.time_light_map[this.startTime],this.wind="number"==typeof this.initConfig.weatherStates.wind?this.initConfig.weatherStates.wind:10,this.blade_pitch=this.getLogicalBladeAngle(),this.worldTime=this.startTime,this.recordState=[],this.hoursProgress=0}endAttempt(){this.studentCodeRunning=!1,this.status="ended";let t=this.verificationFunction(this.verificationAPI);if("default"==t)this.completed="default";else if(this.completed=!0,t instanceof Array)for(let e=0;e<t.length;e++)0==t[e].pass&&(this.completed=!1);else this.completed=t.pass;this.onComplete(t),this.timeLabel.setValue("--")}endWithError(){this.studentCodeRunning=!1,this.status="ended",this.completed=!1,this.onComplete({pass:!1}),this.timeLabel.setValue("--")}defaultEnd(){this.players.forEach(t=>{t.sprite.setVelocityX(0),t.sprite.anims.stop()}),this.stopBirdsAnimation(),this.resetValues()}successfullAttempt(){this.players.forEach(t=>{t.sprite.setVelocityX(0),t.sprite.anims.play(`${t.key}_celebrate`,!0)}),this.stopBirdsAnimation(),this.resetValues()}failedAttempt(){this.players.forEach(t=>{t.sprite.setVelocityX(0),t.sprite.anims.play(`${t.key}_slump`,!0)}),this.stopBirdsAnimation(),this.resetValues()}botAnimation(t){t.sprite.setVelocityX(50*this.bot_direction),(t.sprite.x<=0||t.sprite.x>=400)&&(this.bot_direction=-1*this.bot_direction),t.sprite.x<=0?t.sprite.x=10:t.sprite.x>=400&&(t.sprite.x=390),-1==this.bot_direction?t.sprite.anims.play(`${t.key}_left`,!0):t.sprite.anims.play(`${t.key}_right`,!0)}animateCyclist(t){t.sprite.setVelocityX(t.velocity*t.direction),t.sprite.x<=0?t.sprite.x=395:t.sprite.x>=this.width&&(t.sprite.x=0),t.sprite.anims.play(`${t.key}_ride`,!0)}animateBirds(){this.birds.setVelocityX(20),this.birds.children.iterate(t=>{t.x>=400&&(t.x=0)}),this.birds.playAnimation("bird_fly",!0)}stopBirdsAnimation(){this.birds.setVelocityX(0),this.birds.children.iterate(t=>{t.anims.stop()})}turnPorchLightsOn(){for(let t=0;t<3;t++)this.houses.houses[t].porch_light.getNearestDistance(this.players)<=15?this.houses.houses[t].porch_light.turnOn():this.houses.houses[t].porch_light.turnOff()}checkAlerts(){this.blade_speed>this.blade_speed_max?this.turbineDamage.showText():this.turbineDamage.hideText(),this.low_power?this.lowPowerLabel.showText():this.lowPowerLabel.hideText()}update(){this.studentCodeRunning&&this.isUpdateWorldTime(this.timerEvent)&&this.tick(),"running"==this.status?(this.changeWorldShade(this.worldTime),this.windmills&&this.windmills.all("rotateTurbines",[this.wind,this.blade_pitch]),this.animateBirds(),this.checkAlerts(),this.players.forEach(t=>{"bot"==t.type?this.botAnimation(t):"player"==t.type?this.cursorAnimations(t):"cyclist"==t.type&&this.animateCyclist(t)})):"default"==this.completed?this.events.emit("onDefault"):this.completed?this.events.emit("onSuccess"):this.events.emit("onFailure")}}class k{constructor(t){this.Phaser=t.Phaser||Phaser,t.debug&&void 0!=t.Phaser&&console.log("Using local Phaser");const e={type:this.Phaser.AUTO,banner:!1,physics:{default:"arcade",arcade:{gravity:{y:0}}}};this.sceneConfig=t.sceneConfig;const s=Object.assign({},e,t.gameConfig);this.game=new this.Phaser.Game(s),this.game.scene.add("CityScene",v,!0)}startGame(){return this.game.scene.start("CityScene",this.sceneConfig),this.game.scene.keys}getScene(){return this.game.scene.keys.CityScene}}window.GameController=k;e.default=k}])});