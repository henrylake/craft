!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var r=e();for(var i in r)("object"==typeof exports?exports:t)[i]=r[i]}}(window,function(){return function(t){var e={};function r(i){if(e[i])return e[i].exports;var s=e[i]={i:i,l:!1,exports:{}};return t[i].call(s.exports,s,s.exports,r),s.l=!0,s.exports}return r.m=t,r.c=e,r.d=function(t,e,i){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)r.d(i,s,function(e){return t[e]}.bind(null,s));return i},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=6)}([function(t,e){var r;r=function(){return this}();try{r=r||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(r=window)}t.exports=r},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},function(t,e){t.exports.get=function(t){return{log_scene(){console.log("Scene within API",t)},turn_on(e){switch(e){case"streetlamps":t.setState("streetlamps",!0),t.streetlamps.all("turnOn");break;case"windmills":t.setState("windmills",!0),t.windmills.all("turnOn")}},turn_off(e){switch(e){case"streetlamps":t.setState("streetlamps",!1),t.streetlamps.all("turnOff");break;case"windmills":t.setState("windmills",!1),t.windmills.all("turnOff")}},generate_energy(e){let r=0;switch(e){case"windmills":t.windmills.windmills.forEach(e=>{r+=e.createEnergy(t.wind)})}return r},is_battery_empty:()=>t.battery.isEmpty,is_battery_full:()=>t.battery.isFull,charge_battery(e){t.battery.charge(e),t.batteryLabel.setValue(t.battery.energyValue)},use_battery(e){t.battery.use(e),t.batteryLabel.setValue(t.battery.energyValue)},get_energy:()=>t.battery.energy,get_wind:()=>t.wind,get_light:()=>t.light,get_time:()=>t.worldTime,get_dark:()=>t.worldTime<=t.dawn||t.worldTime>=t.dusk}}},function(t,e,r){var i=r(5);t.exports.get=function(t){return{getRecordState:()=>t.recordState,recordCheck:e=>!!t.recordState.every(t=>{if(e(t))return!0}),comparisonCheck:e=>!!t.recordState.every(t=>{let r=Object.assign({},t);if(e(r),i(r,t))return!0}),turn_on(t,e){t[e]=!0},turn_off(t,e){t[e]=!1},is_on:(t,e)=>1==t[e],is_off:(t,e)=>1!=t[e],get_dark:e=>e.worldTime<=t.dawn||e.worldTime>=t.dusk,get_time:t=>t.worldTime,streetlamps:e=>"on"==e?t.onStates.streetlamps:!t.onStates.streetlamps,getRecordState:()=>t.recordState,stateWhile(e,r,i,s,n,a=!1){"on"==r?r=!0:"off"==r&&(r=!1);for(let o=0;o<t.recordState.length;o++){let l=t.recordState[o],h=l[i],c=l[e],u=!1;switch(s){case"less":u=h<n;break;case"less equal":u=h<=n;break;case"greater":u=h>n;break;case"greater equal":u=h>=n;break;case"between equal":u=h<=n&&h>=a;break;case"between":u=h<n&&h>a}if(u&&c!=r)return!1}return!0},getRecordsAtWorldState(e,r){let i=[];for(let s=0;s<t.recordState.length;s++){let n=t.recordState[s];n[e]==r&&i.push(n)}return i},mirrorSimulate(e,r){let i=[];for(let s=0;s<t.recordState.length;s++){let n=t.recordState[s];n[e]==r&&i.push(n)}return i}}}},function(t,e,r){(function(t,r){var i=200,s="__lodash_hash_undefined__",n=9007199254740991,a="[object Arguments]",o="[object Boolean]",l="[object Date]",h="[object Function]",c="[object GeneratorFunction]",u="[object Map]",p="[object Number]",d="[object Object]",f="[object RegExp]",y="[object Set]",g="[object String]",_="[object Symbol]",m="[object ArrayBuffer]",b="[object DataView]",v="[object Float32Array]",w="[object Float64Array]",S="[object Int8Array]",k="[object Int16Array]",j="[object Int32Array]",C="[object Uint8Array]",x="[object Uint8ClampedArray]",$="[object Uint16Array]",O="[object Uint32Array]",A=/\w*$/,T=/^\[object .+?Constructor\]$/,P=/^(?:0|[1-9]\d*)$/,E={};E[a]=E["[object Array]"]=E[m]=E[b]=E[o]=E[l]=E[v]=E[w]=E[S]=E[k]=E[j]=E[u]=E[p]=E[d]=E[f]=E[y]=E[g]=E[_]=E[C]=E[x]=E[$]=E[O]=!0,E["[object Error]"]=E[h]=E["[object WeakMap]"]=!1;var L="object"==typeof t&&t&&t.Object===Object&&t,V="object"==typeof self&&self&&self.Object===Object&&self,D=L||V||Function("return this")(),F="object"==typeof e&&e&&!e.nodeType&&e,M=F&&"object"==typeof r&&r&&!r.nodeType&&r,W=M&&M.exports===F;function I(t,e){return t.set(e[0],e[1]),t}function R(t,e){return t.add(e),t}function z(t,e,r,i){var s=-1,n=t?t.length:0;for(i&&n&&(r=t[++s]);++s<n;)r=e(r,t[s],s,t);return r}function B(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(t){}return e}function G(t){var e=-1,r=Array(t.size);return t.forEach(function(t,i){r[++e]=[i,t]}),r}function N(t,e){return function(r){return t(e(r))}}function U(t){var e=-1,r=Array(t.size);return t.forEach(function(t){r[++e]=t}),r}var K=Array.prototype,X=Function.prototype,H=Object.prototype,Y=D["__core-js_shared__"],J=function(){var t=/[^.]+$/.exec(Y&&Y.keys&&Y.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),Z=X.toString,q=H.hasOwnProperty,Q=H.toString,tt=RegExp("^"+Z.call(q).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),et=W?D.Buffer:void 0,rt=D.Symbol,it=D.Uint8Array,st=N(Object.getPrototypeOf,Object),nt=Object.create,at=H.propertyIsEnumerable,ot=K.splice,lt=Object.getOwnPropertySymbols,ht=et?et.isBuffer:void 0,ct=N(Object.keys,Object),ut=Ft(D,"DataView"),pt=Ft(D,"Map"),dt=Ft(D,"Promise"),ft=Ft(D,"Set"),yt=Ft(D,"WeakMap"),gt=Ft(Object,"create"),_t=zt(ut),mt=zt(pt),bt=zt(dt),vt=zt(ft),wt=zt(yt),St=rt?rt.prototype:void 0,kt=St?St.valueOf:void 0;function jt(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var i=t[e];this.set(i[0],i[1])}}function Ct(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var i=t[e];this.set(i[0],i[1])}}function xt(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var i=t[e];this.set(i[0],i[1])}}function $t(t){this.__data__=new Ct(t)}function Ot(t,e){var r=Gt(t)||function(t){return function(t){return function(t){return!!t&&"object"==typeof t}(t)&&Nt(t)}(t)&&q.call(t,"callee")&&(!at.call(t,"callee")||Q.call(t)==a)}(t)?function(t,e){for(var r=-1,i=Array(t);++r<t;)i[r]=e(r);return i}(t.length,String):[],i=r.length,s=!!i;for(var n in t)!e&&!q.call(t,n)||s&&("length"==n||It(n,i))||r.push(n);return r}function At(t,e,r){var i=t[e];q.call(t,e)&&Bt(i,r)&&(void 0!==r||e in t)||(t[e]=r)}function Tt(t,e){for(var r=t.length;r--;)if(Bt(t[r][0],e))return r;return-1}function Pt(t,e,r,i,s,n,T){var P;if(i&&(P=n?i(t,s,n,T):i(t)),void 0!==P)return P;if(!Xt(t))return t;var L=Gt(t);if(L){if(P=function(t){var e=t.length,r=t.constructor(e);e&&"string"==typeof t[0]&&q.call(t,"index")&&(r.index=t.index,r.input=t.input);return r}(t),!e)return function(t,e){var r=-1,i=t.length;e||(e=Array(i));for(;++r<i;)e[r]=t[r];return e}(t,P)}else{var V=Wt(t),D=V==h||V==c;if(Ut(t))return function(t,e){if(e)return t.slice();var r=new t.constructor(t.length);return t.copy(r),r}(t,e);if(V==d||V==a||D&&!n){if(B(t))return n?t:{};if(P=function(t){return"function"!=typeof t.constructor||Rt(t)?{}:function(t){return Xt(t)?nt(t):{}}(st(t))}(D?{}:t),!e)return function(t,e){return Vt(t,Mt(t),e)}(t,function(t,e){return t&&Vt(e,Ht(e),t)}(P,t))}else{if(!E[V])return n?t:{};P=function(t,e,r,i){var s=t.constructor;switch(e){case m:return Lt(t);case o:case l:return new s(+t);case b:return function(t,e){var r=e?Lt(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.byteLength)}(t,i);case v:case w:case S:case k:case j:case C:case x:case $:case O:return function(t,e){var r=e?Lt(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.length)}(t,i);case u:return function(t,e,r){return z(e?r(G(t),!0):G(t),I,new t.constructor)}(t,i,r);case p:case g:return new s(t);case f:return function(t){var e=new t.constructor(t.source,A.exec(t));return e.lastIndex=t.lastIndex,e}(t);case y:return function(t,e,r){return z(e?r(U(t),!0):U(t),R,new t.constructor)}(t,i,r);case _:return function(t){return kt?Object(kt.call(t)):{}}(t)}}(t,V,Pt,e)}}T||(T=new $t);var F=T.get(t);if(F)return F;if(T.set(t,P),!L)var M=r?function(t){return function(t,e,r){var i=e(t);return Gt(t)?i:function(t,e){for(var r=-1,i=e.length,s=t.length;++r<i;)t[s+r]=e[r];return t}(i,r(t))}(t,Ht,Mt)}(t):Ht(t);return function(t,e){for(var r=-1,i=t?t.length:0;++r<i&&!1!==e(t[r],r,t););}(M||t,function(s,n){M&&(s=t[n=s]),At(P,n,Pt(s,e,r,i,n,t,T))}),P}function Et(t){return!(!Xt(t)||function(t){return!!J&&J in t}(t))&&(Kt(t)||B(t)?tt:T).test(zt(t))}function Lt(t){var e=new t.constructor(t.byteLength);return new it(e).set(new it(t)),e}function Vt(t,e,r,i){r||(r={});for(var s=-1,n=e.length;++s<n;){var a=e[s],o=i?i(r[a],t[a],a,r,t):void 0;At(r,a,void 0===o?t[a]:o)}return r}function Dt(t,e){var r=t.__data__;return function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t}(e)?r["string"==typeof e?"string":"hash"]:r.map}function Ft(t,e){var r=function(t,e){return null==t?void 0:t[e]}(t,e);return Et(r)?r:void 0}jt.prototype.clear=function(){this.__data__=gt?gt(null):{}},jt.prototype.delete=function(t){return this.has(t)&&delete this.__data__[t]},jt.prototype.get=function(t){var e=this.__data__;if(gt){var r=e[t];return r===s?void 0:r}return q.call(e,t)?e[t]:void 0},jt.prototype.has=function(t){var e=this.__data__;return gt?void 0!==e[t]:q.call(e,t)},jt.prototype.set=function(t,e){return this.__data__[t]=gt&&void 0===e?s:e,this},Ct.prototype.clear=function(){this.__data__=[]},Ct.prototype.delete=function(t){var e=this.__data__,r=Tt(e,t);return!(r<0||(r==e.length-1?e.pop():ot.call(e,r,1),0))},Ct.prototype.get=function(t){var e=this.__data__,r=Tt(e,t);return r<0?void 0:e[r][1]},Ct.prototype.has=function(t){return Tt(this.__data__,t)>-1},Ct.prototype.set=function(t,e){var r=this.__data__,i=Tt(r,t);return i<0?r.push([t,e]):r[i][1]=e,this},xt.prototype.clear=function(){this.__data__={hash:new jt,map:new(pt||Ct),string:new jt}},xt.prototype.delete=function(t){return Dt(this,t).delete(t)},xt.prototype.get=function(t){return Dt(this,t).get(t)},xt.prototype.has=function(t){return Dt(this,t).has(t)},xt.prototype.set=function(t,e){return Dt(this,t).set(t,e),this},$t.prototype.clear=function(){this.__data__=new Ct},$t.prototype.delete=function(t){return this.__data__.delete(t)},$t.prototype.get=function(t){return this.__data__.get(t)},$t.prototype.has=function(t){return this.__data__.has(t)},$t.prototype.set=function(t,e){var r=this.__data__;if(r instanceof Ct){var s=r.__data__;if(!pt||s.length<i-1)return s.push([t,e]),this;r=this.__data__=new xt(s)}return r.set(t,e),this};var Mt=lt?N(lt,Object):function(){return[]},Wt=function(t){return Q.call(t)};function It(t,e){return!!(e=null==e?n:e)&&("number"==typeof t||P.test(t))&&t>-1&&t%1==0&&t<e}function Rt(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||H)}function zt(t){if(null!=t){try{return Z.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function Bt(t,e){return t===e||t!=t&&e!=e}(ut&&Wt(new ut(new ArrayBuffer(1)))!=b||pt&&Wt(new pt)!=u||dt&&"[object Promise]"!=Wt(dt.resolve())||ft&&Wt(new ft)!=y||yt&&"[object WeakMap]"!=Wt(new yt))&&(Wt=function(t){var e=Q.call(t),r=e==d?t.constructor:void 0,i=r?zt(r):void 0;if(i)switch(i){case _t:return b;case mt:return u;case bt:return"[object Promise]";case vt:return y;case wt:return"[object WeakMap]"}return e});var Gt=Array.isArray;function Nt(t){return null!=t&&function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=n}(t.length)&&!Kt(t)}var Ut=ht||function(){return!1};function Kt(t){var e=Xt(t)?Q.call(t):"";return e==h||e==c}function Xt(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function Ht(t){return Nt(t)?Ot(t):function(t){if(!Rt(t))return ct(t);var e=[];for(var r in Object(t))q.call(t,r)&&"constructor"!=r&&e.push(r);return e}(t)}r.exports=function(t){return Pt(t,!0,!0)}}).call(this,r(0),r(1)(t))},function(t,e,r){(function(t,r){var i=200,s="__lodash_hash_undefined__",n=1,a=2,o=9007199254740991,l="[object Arguments]",h="[object Array]",c="[object AsyncFunction]",u="[object Boolean]",p="[object Date]",d="[object Error]",f="[object Function]",y="[object GeneratorFunction]",g="[object Map]",_="[object Number]",m="[object Null]",b="[object Object]",v="[object Proxy]",w="[object RegExp]",S="[object Set]",k="[object String]",j="[object Symbol]",C="[object Undefined]",x="[object ArrayBuffer]",$="[object DataView]",O=/^\[object .+?Constructor\]$/,A=/^(?:0|[1-9]\d*)$/,T={};T["[object Float32Array]"]=T["[object Float64Array]"]=T["[object Int8Array]"]=T["[object Int16Array]"]=T["[object Int32Array]"]=T["[object Uint8Array]"]=T["[object Uint8ClampedArray]"]=T["[object Uint16Array]"]=T["[object Uint32Array]"]=!0,T[l]=T[h]=T[x]=T[u]=T[$]=T[p]=T[d]=T[f]=T[g]=T[_]=T[b]=T[w]=T[S]=T[k]=T["[object WeakMap]"]=!1;var P="object"==typeof t&&t&&t.Object===Object&&t,E="object"==typeof self&&self&&self.Object===Object&&self,L=P||E||Function("return this")(),V="object"==typeof e&&e&&!e.nodeType&&e,D=V&&"object"==typeof r&&r&&!r.nodeType&&r,F=D&&D.exports===V,M=F&&P.process,W=function(){try{return M&&M.binding&&M.binding("util")}catch(t){}}(),I=W&&W.isTypedArray;function R(t,e){for(var r=-1,i=null==t?0:t.length;++r<i;)if(e(t[r],r,t))return!0;return!1}function z(t,e){return t.has(e)}function B(t){var e=-1,r=Array(t.size);return t.forEach(function(t,i){r[++e]=[i,t]}),r}function G(t){var e=-1,r=Array(t.size);return t.forEach(function(t){r[++e]=t}),r}var N=Array.prototype,U=Function.prototype,K=Object.prototype,X=L["__core-js_shared__"],H=U.toString,Y=K.hasOwnProperty,J=function(){var t=/[^.]+$/.exec(X&&X.keys&&X.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),Z=K.toString,q=RegExp("^"+H.call(Y).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Q=F?L.Buffer:void 0,tt=L.Symbol,et=L.Uint8Array,rt=K.propertyIsEnumerable,it=N.splice,st=tt?tt.toStringTag:void 0,nt=Object.getOwnPropertySymbols,at=Q?Q.isBuffer:void 0,ot=function(t,e){return function(r){return t(e(r))}}(Object.keys,Object),lt=Ft(L,"DataView"),ht=Ft(L,"Map"),ct=Ft(L,"Promise"),ut=Ft(L,"Set"),pt=Ft(L,"WeakMap"),dt=Ft(Object,"create"),ft=Rt(lt),yt=Rt(ht),gt=Rt(ct),_t=Rt(ut),mt=Rt(pt),bt=tt?tt.prototype:void 0,vt=bt?bt.valueOf:void 0;function wt(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var i=t[e];this.set(i[0],i[1])}}function St(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var i=t[e];this.set(i[0],i[1])}}function kt(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var i=t[e];this.set(i[0],i[1])}}function jt(t){var e=-1,r=null==t?0:t.length;for(this.__data__=new kt;++e<r;)this.add(t[e])}function Ct(t){var e=this.__data__=new St(t);this.size=e.size}function xt(t,e){var r=Gt(t),i=!r&&Bt(t),s=!r&&!i&&Nt(t),n=!r&&!i&&!s&&Yt(t),a=r||i||s||n,o=a?function(t,e){for(var r=-1,i=Array(t);++r<t;)i[r]=e(r);return i}(t.length,String):[],l=o.length;for(var h in t)!e&&!Y.call(t,h)||a&&("length"==h||s&&("offset"==h||"parent"==h)||n&&("buffer"==h||"byteLength"==h||"byteOffset"==h)||It(h,l))||o.push(h);return o}function $t(t,e){for(var r=t.length;r--;)if(zt(t[r][0],e))return r;return-1}function Ot(t){return null==t?void 0===t?C:m:st&&st in Object(t)?function(t){var e=Y.call(t,st),r=t[st];try{t[st]=void 0;var i=!0}catch(t){}var s=Z.call(t);i&&(e?t[st]=r:delete t[st]);return s}(t):function(t){return Z.call(t)}(t)}function At(t){return Ht(t)&&Ot(t)==l}function Tt(t,e,r,i,s){return t===e||(null==t||null==e||!Ht(t)&&!Ht(e)?t!=t&&e!=e:function(t,e,r,i,s,o){var c=Gt(t),f=Gt(e),y=c?h:Wt(t),m=f?h:Wt(e),v=(y=y==l?b:y)==b,C=(m=m==l?b:m)==b,O=y==m;if(O&&Nt(t)){if(!Nt(e))return!1;c=!0,v=!1}if(O&&!v)return o||(o=new Ct),c||Yt(t)?Lt(t,e,r,i,s,o):function(t,e,r,i,s,o,l){switch(r){case $:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case x:return!(t.byteLength!=e.byteLength||!o(new et(t),new et(e)));case u:case p:case _:return zt(+t,+e);case d:return t.name==e.name&&t.message==e.message;case w:case k:return t==e+"";case g:var h=B;case S:var c=i&n;if(h||(h=G),t.size!=e.size&&!c)return!1;var f=l.get(t);if(f)return f==e;i|=a,l.set(t,e);var y=Lt(h(t),h(e),i,s,o,l);return l.delete(t),y;case j:if(vt)return vt.call(t)==vt.call(e)}return!1}(t,e,y,r,i,s,o);if(!(r&n)){var A=v&&Y.call(t,"__wrapped__"),T=C&&Y.call(e,"__wrapped__");if(A||T){var P=A?t.value():t,E=T?e.value():e;return o||(o=new Ct),s(P,E,r,i,o)}}if(!O)return!1;return o||(o=new Ct),function(t,e,r,i,s,a){var o=r&n,l=Vt(t),h=l.length,c=Vt(e).length;if(h!=c&&!o)return!1;for(var u=h;u--;){var p=l[u];if(!(o?p in e:Y.call(e,p)))return!1}var d=a.get(t);if(d&&a.get(e))return d==e;var f=!0;a.set(t,e),a.set(e,t);for(var y=o;++u<h;){p=l[u];var g=t[p],_=e[p];if(i)var m=o?i(_,g,p,e,t,a):i(g,_,p,t,e,a);if(!(void 0===m?g===_||s(g,_,r,i,a):m)){f=!1;break}y||(y="constructor"==p)}if(f&&!y){var b=t.constructor,v=e.constructor;b!=v&&"constructor"in t&&"constructor"in e&&!("function"==typeof b&&b instanceof b&&"function"==typeof v&&v instanceof v)&&(f=!1)}return a.delete(t),a.delete(e),f}(t,e,r,i,s,o)}(t,e,r,i,Tt,s))}function Pt(t){return!(!Xt(t)||function(t){return!!J&&J in t}(t))&&(Ut(t)?q:O).test(Rt(t))}function Et(t){if(!function(t){var e=t&&t.constructor,r="function"==typeof e&&e.prototype||K;return t===r}(t))return ot(t);var e=[];for(var r in Object(t))Y.call(t,r)&&"constructor"!=r&&e.push(r);return e}function Lt(t,e,r,i,s,o){var l=r&n,h=t.length,c=e.length;if(h!=c&&!(l&&c>h))return!1;var u=o.get(t);if(u&&o.get(e))return u==e;var p=-1,d=!0,f=r&a?new jt:void 0;for(o.set(t,e),o.set(e,t);++p<h;){var y=t[p],g=e[p];if(i)var _=l?i(g,y,p,e,t,o):i(y,g,p,t,e,o);if(void 0!==_){if(_)continue;d=!1;break}if(f){if(!R(e,function(t,e){if(!z(f,e)&&(y===t||s(y,t,r,i,o)))return f.push(e)})){d=!1;break}}else if(y!==g&&!s(y,g,r,i,o)){d=!1;break}}return o.delete(t),o.delete(e),d}function Vt(t){return function(t,e,r){var i=e(t);return Gt(t)?i:function(t,e){for(var r=-1,i=e.length,s=t.length;++r<i;)t[s+r]=e[r];return t}(i,r(t))}(t,Jt,Mt)}function Dt(t,e){var r=t.__data__;return function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t}(e)?r["string"==typeof e?"string":"hash"]:r.map}function Ft(t,e){var r=function(t,e){return null==t?void 0:t[e]}(t,e);return Pt(r)?r:void 0}wt.prototype.clear=function(){this.__data__=dt?dt(null):{},this.size=0},wt.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},wt.prototype.get=function(t){var e=this.__data__;if(dt){var r=e[t];return r===s?void 0:r}return Y.call(e,t)?e[t]:void 0},wt.prototype.has=function(t){var e=this.__data__;return dt?void 0!==e[t]:Y.call(e,t)},wt.prototype.set=function(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=dt&&void 0===e?s:e,this},St.prototype.clear=function(){this.__data__=[],this.size=0},St.prototype.delete=function(t){var e=this.__data__,r=$t(e,t);return!(r<0||(r==e.length-1?e.pop():it.call(e,r,1),--this.size,0))},St.prototype.get=function(t){var e=this.__data__,r=$t(e,t);return r<0?void 0:e[r][1]},St.prototype.has=function(t){return $t(this.__data__,t)>-1},St.prototype.set=function(t,e){var r=this.__data__,i=$t(r,t);return i<0?(++this.size,r.push([t,e])):r[i][1]=e,this},kt.prototype.clear=function(){this.size=0,this.__data__={hash:new wt,map:new(ht||St),string:new wt}},kt.prototype.delete=function(t){var e=Dt(this,t).delete(t);return this.size-=e?1:0,e},kt.prototype.get=function(t){return Dt(this,t).get(t)},kt.prototype.has=function(t){return Dt(this,t).has(t)},kt.prototype.set=function(t,e){var r=Dt(this,t),i=r.size;return r.set(t,e),this.size+=r.size==i?0:1,this},jt.prototype.add=jt.prototype.push=function(t){return this.__data__.set(t,s),this},jt.prototype.has=function(t){return this.__data__.has(t)},Ct.prototype.clear=function(){this.__data__=new St,this.size=0},Ct.prototype.delete=function(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r},Ct.prototype.get=function(t){return this.__data__.get(t)},Ct.prototype.has=function(t){return this.__data__.has(t)},Ct.prototype.set=function(t,e){var r=this.__data__;if(r instanceof St){var s=r.__data__;if(!ht||s.length<i-1)return s.push([t,e]),this.size=++r.size,this;r=this.__data__=new kt(s)}return r.set(t,e),this.size=r.size,this};var Mt=nt?function(t){return null==t?[]:(t=Object(t),function(t,e){for(var r=-1,i=null==t?0:t.length,s=0,n=[];++r<i;){var a=t[r];e(a,r,t)&&(n[s++]=a)}return n}(nt(t),function(e){return rt.call(t,e)}))}:function(){return[]},Wt=Ot;function It(t,e){return!!(e=null==e?o:e)&&("number"==typeof t||A.test(t))&&t>-1&&t%1==0&&t<e}function Rt(t){if(null!=t){try{return H.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function zt(t,e){return t===e||t!=t&&e!=e}(lt&&Wt(new lt(new ArrayBuffer(1)))!=$||ht&&Wt(new ht)!=g||ct&&"[object Promise]"!=Wt(ct.resolve())||ut&&Wt(new ut)!=S||pt&&"[object WeakMap]"!=Wt(new pt))&&(Wt=function(t){var e=Ot(t),r=e==b?t.constructor:void 0,i=r?Rt(r):"";if(i)switch(i){case ft:return $;case yt:return g;case gt:return"[object Promise]";case _t:return S;case mt:return"[object WeakMap]"}return e});var Bt=At(function(){return arguments}())?At:function(t){return Ht(t)&&Y.call(t,"callee")&&!rt.call(t,"callee")},Gt=Array.isArray;var Nt=at||function(){return!1};function Ut(t){if(!Xt(t))return!1;var e=Ot(t);return e==f||e==y||e==c||e==v}function Kt(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=o}function Xt(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function Ht(t){return null!=t&&"object"==typeof t}var Yt=I?function(t){return function(e){return t(e)}}(I):function(t){return Ht(t)&&Kt(t.length)&&!!T[Ot(t)]};function Jt(t){return function(t){return null!=t&&Kt(t.length)&&!Ut(t)}(t)?xt(t):Et(t)}r.exports=function(t,e){return Tt(t,e)}}).call(this,r(0),r(1)(t))},function(t,e,r){"use strict";r.r(e);const i="smart_cities_";class s{constructor(t){this.scene=t,this.audioPlayer=this.scene.audioPlayer;const e=this.scene.assetRoot;this.assets={birds:{type:"spritesheet",path:`${e}${i}birds.png`,frameHeight:15,frameWidth:13},blue_player:{type:"spritesheet",path:`${e}${i}blue_player.png`,frameHeight:45,frameWidth:20},pink_player:{type:"spritesheet",path:`${e}${i}pink_player.png`,frameHeight:45,frameWidth:20},orange_cyclist:{type:"spritesheet",path:`${e}${i}orange_cyclist.png`,frameHeight:55,frameWidth:50},green_cyclist:{type:"spritesheet",path:`${e}${i}green_cyclist.png`,frameHeight:55,frameWidth:50},cloud_large:{type:"image",path:`${e}${i}cloud_large.png`},cloud_small:{type:"image",path:`${e}${i}cloud_small.png`},door_blue:{type:"image",path:`${e}${i}door_blue.png`},door_pink:{type:"image",path:`${e}${i}door_pink.png`},fridge_on:{type:"image",path:`${e}${i}fridge_on.png`},hills:{type:"image",path:`${e}${i}hills.png`},house:{type:"image",path:`${e}${i}house.png`},pavement:{type:"image",path:`${e}${i}pavement.png`},porch_light_on:{type:"image",path:`${e}${i}porch_light_on.png`},porch_light_off:{type:"image",path:`${e}${i}porch_light_off.png`},road:{type:"image",path:`${e}${i}road.png`},solar_panel:{type:"image",path:`${e}${i}solar_panel.png`},solar_panel_on:{type:"image",path:`${e}${i}solar_panel_on.png`},streetlamp_on:{type:"image",path:`${e}${i}streetlamp_on.png`},streetlamp_off:{type:"image",path:`${e}${i}streetlamp_off.png`},streetlamp_modern_on:{type:"image",path:`${e}${i}streetlamp_modern_on.png`},streetlamp_modern_off:{type:"image",path:`${e}${i}streetlamp_modern_off.png`},windmill_tower:{type:"image",path:`${e}${i}windmill_tower.png`},windmill_turbine:{type:"image",path:`${e}${i}windmill_turbine.png`},window:{type:"image",path:`${e}${i}window.png`},window_lights:{type:"image",path:`${e}${i}window_lights.png`},window_small:{type:"image",path:`${e}${i}window_small.png`},window_small_lights:{type:"image",path:`${e}${i}window_small_lights.png`},failure_sound:{type:"sound",ogg:`${e}tl_failure_kenny_musicJingles_jingles_PIZZI11.ogg`,mp3:`${e}tl_failure_kenny_musicJingles_jingles_PIZZI11.mp3`},success_sound:{type:"sound",ogg:`${e}tl_success_kenny_musicJingles_jingles_STEEL10.ogg`,mp3:`${e}tl_success_kenny_musicJingles_jingles_STEEL10.mp3`}},this.assetPacks={allAssets:["birds","blue_player","pink_player","orange_cyclist","green_cyclist","cloud_large","cloud_small","door_blue","door_pink","fridge_on","hills","house","pavement","porch_light_on","porch_light_off","road","solar_panel","solar_panel_on","streetlamp_on","streetlamp_off","streetlamp_modern_on","streetlamp_modern_off","windmill_tower","windmill_turbine","window","window_lights","window_small","window_small_lights","success_sound","failure_sound"]}}loadPacks(t){t.forEach(t=>{this.loadPack(t)})}loadPack(t){let e=this.assetPacks[t];this.loadAssets(e)}loadAssets(t){t.forEach(t=>{let e=this.assets[t];this.loadAsset(t,e)})}loadAsset(t,e){switch(e.type){case"image":this.scene.load.image(t,e.path);break;case"spritesheet":this.scene.load.spritesheet(t,e.path,{frameWidth:e.frameWidth,frameHeight:e.frameHeight});break;case"sound":this.scene.load.audio(t,[e.ogg,e.mp3]),this.audioPlayer.register({id:t,mp3:e.mp3,ogg:e.ogg});break;default:throw`Asset ${t} needs config.type set in configuration.`}}}let n=window.Phaser;const a=(t,e,r)=>"-1"!=r?`${t} ${e}${r}`:`${t} ${e}`;class o extends n.GameObjects.Text{constructor(t,e,r,i,s,n,o){super(t,e,r,a(i,s,o),n),this.state=i,this.value=s,this.ending=o}setValue(t){this.value=t,this.updateValueText()}increment(t){this.setValue(this.value+t)}updateValueText(){this.setText(a(this.state,this.value,this.ending))}removeText(){this.setVisible(!1)}}var l=r(2),h=r.n(l),c=r(3),u=r.n(c);class p{constructor(t,e,r,i,s,n,a){this.scene=t,this.key=e,this.x=r,this.y=i,this.offset=s,this.onState=n,this.conversionRate=a,this.energy=void 0}get isOn(){return this.onState}turnOn(){this.onState=!0}turnOff(){this.onState=!1}createEnergy(t){return this.energy=t*this.conversionRate,this.energy}}class d extends p{constructor(t,e,r,i,s,n){super(t,e,r,i,s,n,.003),this.turbine=this.createTurbine(),this.sprite=this.setupSprite()}createTurbine(){let t=this.scene.add.image(this.x,this.y,"windmill_turbine").setOrigin(this.offset.x,this.offset.y);return t.rotation+=50*Math.random(),t}rotateTurbines(t){let e=.003*t;this.onState&&(this.turbine.rotation+=e)}setupSprite(){let t=this.scene.add.group(),e=this.scene.add.image(this.x,this.y,"windmill_tower").setOrigin(this.offset.x,this.offset.y);return t.add(e),t.add(this.turbine),t}}class f extends p{constructor(t,e,r,i,s,n){super(t,e,r,i,s,n,.004),this.onKey="solar_panel_on",this.offKey="solar_panel",this.sprite=this.setupSprite()}setupSprite(){let t=this.onState?this.onKey:this.offKey;return this.scene.add.image(this.x,this.y,t).setOrigin(this.offset.x,this.offset.y)}turnOn(){this.onState=!0,this.update()}turnOff(){this.onState=!1,this.update()}update(){this.onState?this.sprite.setTexture(this.onKey):this.sprite.setTexture(this.offKey)}}class y{constructor(t,e,r,i,s,n,a,o,l){this.scene=t,this.key=e,this.x=r,this.y=i,this.offset=s,this.onState=o,this.energyConsumption=l,this.energy=void 0,this.onKey=n,this.offKey=a,this.sprite=this.setupSprite()}setupSprite(){let t=this.onState?this.onKey:this.offKey;return this.scene.add.image(this.x,this.y,t).setOrigin(this.offset.x,this.offset.y)}update(){this.onState?this.sprite.setTexture(this.onKey):this.sprite.setTexture(this.offKey)}get isOn(){return this.onState}get consumptionRate(){return this.energyConsumption}turnOn(){this.onState=!0,this.update()}turnOff(){this.onState=!1,this.update()}getProximity(t,e){let r=t.x,i=e.x;return Math.abs(r-i)}getNearestDistance(t){let e=400;return t.forEach(t=>{if("cyclist"!=t.type){let r=this.getProximity(this.sprite,t.sprite);r<e&&(e=r)}}),e}getNearestPlayer(t){let e=400,r=void 0;return t.forEach(t=>{if("cyclist"!=t.type){let i=this.getProximity(this.sprite,t.sprite);i<e&&(e=i,r=t.sprite)}}),r}getEnergyConsumed(){return this.onState?this.energyConsumption:0}useEnergy(t){return t>this.energyConsumption?this.energyConsumption:(this.onState=!1,0)}}class g extends y{constructor(t,e,r,i,s,n,a,o){super(t,e,r,i,s,n,a,o,12)}}class _ extends y{constructor(t,e,r,i,s,n,a,o){super(t,e,r,i,s,n,a,o,2)}}class m extends y{constructor(t,e,r,i,s,n,a,o){super(t,e,r,i,s,n,a,o,4)}setupSprite(){let t=this.onKey[0],e=this.onKey[1],r=this.scene.add.group(),i=this.scene.add.image(this.x,this.y,t).setOrigin(this.offset.x,this.offset.y),s=this.scene.add.image(this.x+15,this.y+40,e).setOrigin(this.offset.x,this.offset.y);return r.add(i),r.add(s),this.onState?r.setVisible(!0):r.setVisible(!1),r}update(){this.onState?this.sprite.setVisible(!0):this.sprite.setVisible(!1)}}class b{constructor(t){this.key="Sensor",this.scene=t,this.dawn=8,this.dusk=19,this.darkLums=16,this.lightLums=10}get wind(){return this.scene.wind}get light(){return this.scene.light}get time(){return this.scene.worldTime}get isWindy(){return this.scene.wind>=10}get isFlat(){return this.scene.wind<10}get isLight(){return this.scene.light>=this.lightLums}get isDark(){return this.scene.light<=this.darkLums}get isEvening(){return this.scene.time>=this.dusk}get isDaytime(){return this.scene.time>=this.dusk&&this.scene.time<=this.dawn}}class v{constructor(t){this.key="Battery",this.maxCapacity=400,this.filling=!1,this.using=!1,this.energy=t}get energyValue(){return this.energy}get isFilling(){return this.filling}get isUsing(){return this.using}get isFull(){return this.energy>=this.maxCapacity}get isEmpty(){return 0==this.energy}charge(t){this.isFull||(this.energy+=t)}use(t){this.isEmpty||(this.energy-=t)}}r(4);let w=window.Phaser;class S extends w.Scene{constructor(){super({key:"CityScene"}),this.API=h.a.get(this),this.verificationAPI=u.a.get(this),this.camera=void 0,this.status="setup",this.dawn=8,this.dusk=20,this.fullyLight=10,this.getDark=16,this.hoursProgress=0,this.width=400,this.height=400,this.street=void 0,this.windmills=void 0,this.streetlamps=void 0,this.battery=void 0,this.light=void 0,this.wind=void 0,this.worldTime=void 0,this.lightLabel=void 0,this.windLabel=void 0,this.timeLabel=void 0,this.energyConsumedLabel=void 0,this.recordState=[],this.cursors=void 0,this.studentCodeRunning=!1,this.completed=void 0,this.bot_direction=void 0,this.players=[],this.errorThrown=!1}init(t){this.initConfig={audioPlayer:t.audioPlayer,timeStates:t.timeStates,weatherStates:{wind:t.weatherStates.wind,light:t.weatherStates.light},sceneSetup:t.sceneSetup,battery:t.battery,onStates:t.onStates,player:t.player,studentCode:t.studentCode,onComplete:t.onComplete,verificationFunction:t.verificationFunction},this.audioPlayer=t.audioPlayer,this.assetRoot=t.assetRoot||"assets/",this.onStates=t.onStates,this.onStates={windmills:t.onStates.includes("windmills"),streetlamps:t.onStates.includes("streetlamps"),porch_lights:t.onStates.includes("porch_lights"),window_lights:t.onStates.includes("window_lights"),solar_panels:t.onStates.includes("solar_panels")},this.startTime=t.timeStates[0],this.endTime=t.timeStates[1],this.timeScale=t.timeStates[2],this.sceneSetup=t.sceneSetup,this.light=t.weatherStates.light,this.wind=t.weatherStates.wind,this.worldTime=t.timeStates[0];let e=t.battery[0]||20;this.battery=new v(e),this.batteryLabel=t.battery[1],this.energyConsumedLabel=t.battery[2],this.energyConsumed=0,this.studentCode=t.studentCode,this.onComplete=t.onComplete,this.verificationFunction=t.verificationFunction,this.directions=[-1,1],this.bot_direction=this.directions[Math.floor(Math.random()*this.directions.length)],this.pink_player={key:"pink_player",x:Math.floor(300*Math.random())+50,y:295,initDirection:this.bot_direction,type:"pink_player"==t.player?"player":"bot",active:t.sceneSetup.includes("pink_player")},this.blue_player={key:"blue_player",x:Math.floor(300*Math.random())+50,y:300,initDirection:this.bot_direction,type:"blue_player"==t.player?"player":"bot",active:t.sceneSetup.includes("blue_player")},this.orange_cyclist={key:"orange_cyclist",x:Math.floor(300*Math.random())+50,y:340,direction:1,type:"cyclist",velocity:100,active:t.sceneSetup.includes("orange_cyclist")},this.green_cyclist={key:"green_cyclist",x:Math.floor(300*Math.random())+50,y:360,direction:-1,type:"cyclist",velocity:140,active:t.sceneSetup.includes("green_cyclist")}}preload(){this.assetLoader=new s(this),this.assetLoader.loadPack("allAssets")}create(){this.camera=this.cameras.add(0,0,400,400),this.hills=this.add.image(0,250,"hills").setOrigin(0,1),this.windmills=!!this.sceneSetup.includes("windmills")&&this.createWindmills(),this.birds=this.createBirds(),this.street=this.createStreet(),this.houses=this.createHouses(),this.setupPlayers([this.pink_player,this.blue_player]),this.streetlamps=!!this.sceneSetup.includes("streetlamps")&&this.createStreetlamps(),this.setupPlayers([this.orange_cyclist,this.green_cyclist]),this.lightLabel=!!this.light&&this.createStateLabel(16,375,"Light (lx):",this.light),this.windLabel=!!this.wind&&this.createStateLabel(16,355,"Wind (kn):",this.wind),this.batteryLabel=!!this.batteryLabel&&this.createStateLabel(200,355,"Battery (W):",this.battery.energyValue),this.energyConsumedLabel=!!this.energyConsumedLabel&&this.createStateLabel(200,375,"Energy Consumed (kWh):",this.energyConsumed),this.timeLabel=this.createStateLabel(310,16,"Time:","--","big"),this.cursors=this.input.keyboard.createCursorKeys(),this.sensor=new b(this),this.failureSound=this.sound.add("failure_sound"),this.successSound=this.sound.add("success_sound"),this.addOnceListners(),[this.pink_player,this.blue_player,this.orange_cyclist,this.green_cyclist].forEach(t=>{t.active&&this.players.push(t)}),this.status="running"}addOnceListners(){this.events.once("onDefault",()=>{this.defaultEnd()},this),this.events.once("onSuccess",()=>{this.audioPlayer.play("success_sound",{volume:.3}),this.successfullAttempt()},this),this.events.once("onFailure",()=>{this.audioPlayer.play("failure_sound",{volume:.3}),this.failedAttempt()},this)}setupPlayers(t){t.forEach(t=>{t.active&&("cyclist"==t.type?t.sprite=this.createCyclist(t):t.sprite=this.createPlayer(t))})}createStreet(){let t=this.physics.add.staticGroup();return t.create(0,350,"pavement").setOrigin(0,1),t.create(0,400,"road").setOrigin(0,1),t}createHouses(){let t=this.add.group(),e=[];for(let r=0;r<3;r++){let i={};i.bricks=t.create(50+100*r,300,"house").setOrigin(0,1),this.sceneSetup.includes("solar_panels")&&(i.solar_panel=new f(this,"solar_panel",120+100*r,195,{x:0,y:1},this.onStates.solar_panels)),i.window=t.create(65+100*r,245,"window").setOrigin(0,1),i.window_small=t.create(80+100*r,285,"window_small").setOrigin(0,1),i.window_lights=new m(this,"window_lights",65+100*r,245,{x:0,y:1},["window_lights","window_small_lights"],null,this.onStates.window_lights),i.door=t.create(115+100*r,300,"door_pink").setOrigin(0,1),i.porch_light=new _(this,"porch_light",108+100*r,254,{x:.5,y:.5},"porch_light_on","porch_light_off",this.onStates.porch_lights),e.push(i)}return{houses:e,housesGroup:t}}createStreetlamps(){let t={streetlamps:[]};t.group=this.add.group();let e=5,r=350;for(let i=0;i<3;i++){let s=new g(this,"streetlamp",e+150*i,r,{x:0,y:1},"streetlamp_modern_on","streetlamp_modern_off",this.onStates.streetlamps);t.streetlamps.push(s),t.group.add(s.sprite)}return t.all=((e,r=[])=>{t.streetlamps.forEach(t=>{r!=[]?t[e](...r):t[e]()})}),t}createWindmills(){let t={windmills:[]},e=[{x:50,y:85},{x:120,y:110},{x:205,y:80},{x:250,y:90}],r=30,i=-36,s={x:.476,y:.365};for(let n=0;n<4;n++){let a=new d(this,"windmill",e[n].x+r,e[n].y+i,s,this.onStates.windmills);t.windmills.push(a)}return t.all=((e,r=[])=>{t.windmills.forEach(t=>{r!=[]?t[e](...r):t[e]()})}),t}createBirds(){const t=this.physics.add.group({key:"birds",repeat:Math.floor(4*Math.random()),setXY:{x:100,y:75,stepX:10*Math.random()+10,stepY:10*Math.random()+10}});return this.anims.create({key:"bird_fly",frames:this.anims.generateFrameNumbers("birds",{start:0,end:9}),frameRate:10,repeat:-1}),t}createCyclist(t){let e=this.physics.add.sprite(t.x,t.y,t.key);return e.body.gravity.y=0,this.anims.create({key:`${t.key}_ride`,frames:this.anims.generateFrameNumbers(t.key,{start:0,end:3}),frameRate:10,repeat:-1}),this.anims.create({key:`${t.key}_celebrate`,frames:this.anims.generateFrameNumbers(t.key,{frames:[4,5,4,5]}),frameRate:10,repeat:2}),this.anims.create({key:`${t.key}_slump`,frames:this.anims.generateFrameNumbers(t.key,{frames:[0,6,7]}),frameRate:10}),e}createPlayer(t){let e=this.physics.add.sprite(t.x,t.y,t.key);return e.body.gravity.y=0,this.anims.create({key:`${t.key}_left`,frames:this.anims.generateFrameNumbers(t.key,{start:0,end:3}),frameRate:10,repeat:-1}),this.anims.create({key:`${t.key}_turn`,frames:[{key:t.key,frame:4}],frameRate:20}),this.anims.create({key:`${t.key}_right`,frames:this.anims.generateFrameNumbers(t.key,{start:5,end:8}),frameRate:10,repeat:-1}),this.anims.create({key:`${t.key}_celebrate`,frames:this.anims.generateFrameNumbers(t.key,{start:9,end:13}),frameRate:10,repeat:2}),e.on(w.Animations.Events.ANIMATION_COMPLETE_KEY+`${t.key}_celebrate`,function(){this.scene.pause()},this),this.anims.create({key:`${t.key}_slump`,frames:this.anims.generateFrameNumbers(t.key,{start:13,end:15}),frameRate:10}),e.on(w.Animations.Events.ANIMATION_COMPLETE_KEY+`${t.key}_slump`,function(){this.scene.pause()},this),e}createStateLabel(t,e,r,i,s="small",n=-1){const a=new o(this,t,e,r,i,"big"==s?{fontSize:"18px",fill:"#fff"}:{fontSize:"13px",fill:"#fff"},n);return this.add.existing(a),a}drawClock(t){this.timeLabel.setValue(`${t}`)}updateLight(){this.worldTime<this.fullyLight&&(this.light+=10),this.worldTime>=this.getDark&&(this.light-=10),this.lightLabel&&this.lightLabel.setValue(this.light)}updateWind(){this.worldTime<this.fullyLight&&(this.wind+=.5),this.worldTime>=this.getDark&&(this.wind-=.5),this.windLabel&&this.windLabel.setValue(this.wind)}changeWorldShade(t){var e=w.Display.Color.ValueToColor("#0F2F3A"),r=w.Display.Color.ValueToColor("#38C1FF"),i="#38C1FF",s=new w.Display.Color(150,150,150),n=new w.Display.Color(255,255,255),a=n;t<this.fullyLight&&(i=w.Display.Color.Interpolate.ColorWithColor(e,r,this.fullyLight,t),a=w.Display.Color.Interpolate.ColorWithColor(s,n,this.fullyLight,t)),t>this.getDark&&(i=w.Display.Color.Interpolate.ColorWithColor(r,e,24-this.getDark,t-this.getDark),a=w.Display.Color.Interpolate.ColorWithColor(n,s,24-this.getDark,t-this.getDark)),this.houses.housesGroup.setTint(w.Display.Color.GetColor(a.r,a.g,a.b)),this.street.setTint(w.Display.Color.GetColor(a.r,a.g,a.b)),this.hills.setTint(w.Display.Color.GetColor(a.r,a.g,a.b)),this.players.forEach(t=>{this.tintPlayer(t.sprite,a)});for(let t=0;t<3;t++){let e=this.houses.houses[t];e.porch_light.isOn?e.porch_light.sprite.setTint(w.Display.Color.GetColor(255,255,255)):e.porch_light.sprite.setTint(w.Display.Color.GetColor(a.r,a.g,a.b))}!this.onStates.streetlamps&&this.streetlamps?this.streetlamps.group.setTint(w.Display.Color.GetColor(a.r,a.g,a.b)):this.streetlamps&&this.onStates.streetlamps&&this.streetlamps.group.setTint(w.Display.Color.GetColor(255,255,255)),this.camera.setBackgroundColor(i)}tintPlayer(t,e){this.isUnderOnStreetlamp(t)?t.setTint(w.Display.Color.GetColor(210,210,210)):t.setTint(w.Display.Color.GetColor(e.r,e.g,e.b))}isUnderOnStreetlamp(t){return!(!(t.x>=5&&t.x<=95||t.x>=155&&t.x<=245||t.x>=310&&t.x<=400)||!this.onStates.streetlamps)}setState(t,e){this.onStates[t]=e}isUpdateWorldTime(t){let e=60*(this.endTime-this.startTime)*t.getOverallProgress();return this.hoursProgress=Math.round(e/60),this.worldTime<this.startTime+this.hoursProgress}updateEnergyValues(){let t=[];this.houses.houses.forEach(e=>{t.push(e.porch_light),t.push(e.window_lights)}),this.streetlamps&&this.streetlamps.streetlamps.forEach(e=>{t.push(e)});let e=0;t.forEach(t=>{e+=t.getEnergyConsumed()}),this.energyConsumed=e,this.energyConsumedLabel&&this.energyConsumedLabel.setValue(this.energyConsumed),this.battery.use(e),this.batteryLabel&&this.batteryLabel.setValue(this.battery.energyValue)}tick(){try{this.studentCode(this.API)}catch(t){this.errorThrown||(console.error(t),this.errorThrown=!0)}this.updateLight(),this.updateWind(),this.updateEnergyValues(),this.drawClock(this.worldTime);let t={worldTime:this.worldTime,light:this.light,streetlamps:this.onStates.streetlamps,lights:this.onStates.lights};this.recordState.push(t),this.worldTime=this.startTime+this.hoursProgress,this.worldTime==this.endTime&&this.endAttempt()}cursorAnimations(t){this.cursors.left.isDown?(t.sprite.setVelocityX(-80),t.sprite.anims.play(`${t.key}_left`,!0)):this.cursors.right.isDown?(t.sprite.setVelocityX(80),t.sprite.anims.play(`${t.key}_right`,!0)):(t.sprite.setVelocityX(0),t.sprite.anims.play(`${t.key}_turn`)),this.cursors.up.isDown&&t.sprite.body.touching.down&&t.sprite.setVelocityY(-330)}startAttempt(){this.worldTime=this.startTime,this.errorThrown=!1,this.resetValues(),this.recordState=[],this.addOnceListners(),this.timerEvent=this.time.addEvent({delay:5e3,timeScale:this.timeScale}),this.status="running",this.studentCodeRunning=!0}resetAttempt(){this.status="resetting",this.errorThrown=!1,this.players=[],this.resetValues(),this.scene.restart(this.initConfig),this.status="running",this.studentCodeRunning=!1,this.timerEvent=this.time.addEvent({delay:5e3,timeScale:this.timeScale})}resetValues(){this.onStates={windmills:this.initConfig.onStates.includes("windmills"),streetlamps:this.initConfig.onStates.includes("streetlamps"),porch_lights:this.initConfig.onStates.includes("porch_lights"),window_lights:this.initConfig.onStates.includes("window_lights"),solar_panels:this.initConfig.onStates.includes("solar_panels")},this.light=this.initConfig.weatherStates.light,this.wind=this.initConfig.weatherStates.wind,this.worldTime=this.startTime,this.recordState=[],this.hoursProgress=0}endAttempt(){this.studentCodeRunning=!1,this.status="ended";let t=this.verificationFunction(this.verificationAPI);if("default"==t)this.completed="default";else if(this.completed=!0,t instanceof Array)for(let e=0;e<t.length;e++)0==t[e]&&(this.completed=!1);else this.completed=t;this.onComplete(t),this.timeLabel.setValue("--")}defaultEnd(){this.players.forEach(t=>{t.sprite.setVelocityX(0),t.sprite.anims.stop()}),this.stopBirdsAnimation(),this.resetValues()}successfullAttempt(){this.players.forEach(t=>{t.sprite.setVelocityX(0),t.sprite.anims.play(`${t.key}_celebrate`,!0)}),this.stopBirdsAnimation(),this.resetValues()}failedAttempt(){this.players.forEach(t=>{t.sprite.setVelocityX(0),t.sprite.anims.play(`${t.key}_slump`,!0)}),this.stopBirdsAnimation(),this.resetValues()}botAnimation(t){t.sprite.setVelocityX(50*this.bot_direction),(t.sprite.x<=0||t.sprite.x>=400)&&(this.bot_direction=-1*this.bot_direction),t.sprite.x<=0?t.sprite.x=10:t.sprite.x>=400&&(t.sprite.x=390),-1==this.bot_direction?t.sprite.anims.play(`${t.key}_left`,!0):t.sprite.anims.play(`${t.key}_right`,!0)}animateCyclist(t){t.sprite.setVelocityX(t.velocity*t.direction),t.sprite.x<=0?t.sprite.x=395:t.sprite.x>=this.width&&(t.sprite.x=0),t.sprite.anims.play(`${t.key}_ride`,!0)}animateBirds(){this.birds.setVelocityX(20),this.birds.children.iterate(t=>{t.x>=400&&(t.x=0)}),this.birds.playAnimation("bird_fly",!0)}stopBirdsAnimation(){this.birds.setVelocityX(0),this.birds.children.iterate(t=>{t.anims.stop()})}turnPorchLightsOn(){for(let t=0;t<3;t++)this.houses.houses[t].porch_light.getNearestDistance(this.players)<=15?this.houses.houses[t].porch_light.turnOn():this.houses.houses[t].porch_light.turnOff()}update(){this.studentCodeRunning&&this.isUpdateWorldTime(this.timerEvent)&&this.tick(),"running"==this.status?(this.changeWorldShade(this.worldTime),this.windmills&&this.windmills.all("rotateTurbines",[this.wind]),this.animateBirds(),this.players.forEach(t=>{"bot"==t.type?this.botAnimation(t):"player"==t.type?this.cursorAnimations(t):"cyclist"==t.type&&this.animateCyclist(t)})):"default"==this.completed?this.events.emit("onDefault"):this.completed?this.events.emit("onSuccess"):this.events.emit("onFailure")}}class k{constructor(t){this.Phaser=t.Phaser||Phaser,t.debug&&void 0!=t.Phaser&&console.log("Using local Phaser");const e={type:this.Phaser.AUTO,banner:!1,physics:{default:"arcade",arcade:{gravity:{y:0}}}};this.sceneConfig=t.sceneConfig;const r=Object.assign({},e,t.gameConfig);this.game=new this.Phaser.Game(r),this.game.scene.add("CityScene",S,!0)}startGame(){return this.game.scene.start("CityScene",this.sceneConfig),this.game.scene.keys}getScene(){return this.game.scene.keys.CityScene}}window.GameController=k;e.default=k}])});